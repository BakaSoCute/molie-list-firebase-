let e,t,n,r;var i,s,a,o,l,u,h,c,f,d,p,g,m,y,v,w,b,E,_,T="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function I(e){return new URL(C+(e=x.i?.[e]||e),import.meta.url).toString()}var C="./",S={},A={},x=T.parcelRequire4f95;null==x&&((x=function(e){if(e in S)return S[e].exports;if(e in A){var t=A[e];delete A[e];var n={id:e,exports:{}};return S[e]=n,t.call(n.exports,n,n.exports),n.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){A[e]=t},T.parcelRequire4f95=x),x.register,Object.assign(x.i??={},{j8q2G:"crug.92d18722.png","9iuTZ":"crest.19b3f623.png"});var D={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};const N=new Uint8Array(16),k=[];for(let e=0;e<256;++e)k.push((e+256).toString(16).slice(1));var R=function(t,n,r){if(D.randomUUID&&!n&&!t)return D.randomUUID();let i=(t=t||{}).random??t.rng?.()??function(){if(!e){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");e=crypto.getRandomValues.bind(crypto)}return e(N)}();if(i.length<16)throw Error("Random bytes length must be >= 16");if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,n){if((r=r||0)<0||r+16>n.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)n[r+e]=i[e];return n}return function(e,t=0){return(k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]).toLowerCase()}(i)};const L=()=>void 0,O=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},M=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=e[n++],a=((7&i)<<18|(63&s)<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(1023&a))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},P={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,f=63&l;!o&&(f=64,s||(c=64)),r.push(n[u],n[h],n[c],n[f])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(O(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):M(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new V;let l=i<<2|s>>4;if(r.push(l),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class V extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const U=function(e){let t=O(e);return P.encodeByteArray(t,!0)},B=function(e){return U(e).replace(/\./g,"")},F=function(e){try{return P.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},j=()=>(function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==T)return T;throw Error("Unable to locate global object.")})().__FIREBASE_DEFAULTS__,$=()=>{},q=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&F(e[1]);return t&&JSON.parse(t)},z=()=>{try{return L()||j()||$()||q()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},G=e=>{var t,n;return null==(n=null==(t=z())?void 0:t.emulatorHosts)?void 0:n[e]},H=e=>{let t=G(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},K=()=>{var e;return null==(e=z())?void 0:e.config};class Q{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function W(e){return e.endsWith(".cloudworkstations.dev")}async function Y(e){return(await fetch(e,{credentials:"include"})).ok}const X={};let J=!1;function Z(e,t){if("undefined"==typeof window||"undefined"==typeof document||!W(window.location.host)||X[e]===t||X[e]||J)return;function n(e){return`__firebase__banner__${e}`}X[e]=t;let r="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(X))X[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(r),t=!1,e||((e=document.createElement("div")).setAttribute("id",r),t=!0),{created:t,element:e}),a=n("text"),o=document.getElementById(a)||document.createElement("span"),l=n("learnmore"),u=document.getElementById(l)||document.createElement("a"),h=n("preprendIcon"),c=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e=s.element;e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let t=function(){let e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{J=!0;let e=document.getElementById(r);e&&e.remove()},e}();c.setAttribute("width","24"),c.setAttribute("id",h),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",e.append(c,o,u,t),document.body.appendChild(e)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}class ee extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,ee.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,et.prototype.create)}}class et{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(n=a,r=i,n.replace(en,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new ee(s,l,i)}}const en=/\{\$([^}]+)}/g;function er(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(ei(n)&&ei(s)){if(!er(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function ei(e){return null!==e&&"object"==typeof e}function es(e){return e&&e._delegate?e._delegate:e}class ea{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const eo="[DEFAULT]";class el{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new Q;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:eo})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=eo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=eo){return this.instances.has(e)}getOptions(e=eo){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;let r=this.normalizeInstanceIdentifier(t),i=null!=(n=this.onInitCallbacks.get(r))?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===eo?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}return r||null}normalizeInstanceIdentifier(e=eo){return this.component?this.component.multipleInstances?e:eo:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class eu{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new el(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const eh=[];(i=s||(s={}))[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT";const ec={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},ef=s.INFO,ed={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},ep=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=ed[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eg{constructor(e){this.name=e,this._logLevel=ef,this._logHandler=ep,this._userLogHandler=null,eh.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ec[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}const em=(e,t)=>t.some(t=>e instanceof t),ey=new WeakMap,ev=new WeakMap,ew=new WeakMap,eb=new WeakMap,eE=new WeakMap;let e_={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return ev.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ew.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return eT(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eT(e){if(e instanceof IDBRequest){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eT(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&ey.set(t,e)}).catch(()=>{}),eE.set(t,e),t}if(eb.has(e))return eb.get(e);let r=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eI(this),t),eT(ey.get(this))}:function(...t){return eT(e.apply(eI(this),t))}:function(t,...n){let r=e.call(eI(this),t,...n);return ew.set(r,t.sort?t.sort():[t]),eT(r)};return(e instanceof IDBTransaction&&function(e){if(ev.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});ev.set(e,t)}(e),em(e,t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,e_):e}(e);return r!==e&&(eb.set(e,r),eE.set(r,e)),r}const eI=e=>eE.get(e),eC=["get","getKey","getAll","getAllKeys","count"],eS=["put","add","delete","clear"],eA=new Map;function ex(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eA.get(t))return eA.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=eS.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||eC.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&s.done]))[0]};return eA.set(t,s),s}e_={...r=e_,get:(e,t,n)=>ex(e,t)||r.get(e,t,n),has:(e,t)=>!!ex(e,t)||r.has(e,t)};class eD{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}const eN="@firebase/app",ek="0.13.0",eR=new eg("@firebase/app"),eL="[DEFAULT]",eO={[eN]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eM=new Map,eP=new Map,eV=new Map;function eU(e,t){try{e.container.addComponent(t)}catch(n){eR.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function eB(e){let t=e.name;if(eV.has(t))return eR.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(eV.set(t,e),eM.values()))eU(n,e);for(let t of eP.values())eU(t,e);return!0}const eF=new et("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ej{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ea("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw eF.create("app-deleted",{appName:this._name})}}function e$(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r=Object.assign({name:eL,automaticDataCollectionEnabled:!0},t),i=r.name;if("string"!=typeof i||!i)throw eF.create("bad-app-name",{appName:String(i)});if(n||(n=K()),!n)throw eF.create("no-options");let s=eM.get(i);if(s)if(er(n,s.options)&&er(r,s.config))return s;else throw eF.create("duplicate-app",{appName:i});let a=new eu(i);for(let e of eV.values())a.addComponent(e);let o=new ej(n,r,a);return eM.set(i,o),o}function eq(e,t,n){var r;let i=null!=(r=eO[e])?r:e;n&&(i+=`-${n}`);let s=i.match(/\s|\//),a=t.match(/\s|\//);if(s||a){let e=[`Unable to register library "${i}" with version "${t}":`];s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eR.warn(e.join(" "));return}eB(new ea(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}const ez="firebase-heartbeat-store";let eG=null;function eH(){return eG||(eG=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=eT(a);return r&&a.addEventListener("upgradeneeded",e=>{r(eT(a.result),e.oldVersion,e.newVersion,eT(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ez)}catch(e){console.warn(e)}}}).catch(e=>{throw eF.create("idb-open",{originalErrorMessage:e.message})})),eG}async function eK(e){try{let t=(await eH()).transaction(ez),n=await t.objectStore(ez).get(eW(e));return await t.done,n}catch(e){if(e instanceof ee)eR.warn(e.message);else{let t=eF.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});eR.warn(t.message)}}}async function eQ(e,t){try{let n=(await eH()).transaction(ez,"readwrite"),r=n.objectStore(ez);await r.put(t,eW(e)),await n.done}catch(e){if(e instanceof ee)eR.warn(e.message);else{let t=eF.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});eR.warn(t.message)}}}function eW(e){return`${e.name}!${e.options.appId}`}class eY{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new eJ(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=eX();if((null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){eR.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=eX(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),eZ(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),eZ(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=B(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return eR.warn(e),""}}}function eX(){return new Date().toISOString().substring(0,10)}class eJ{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await eK(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return eQ(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return eQ(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function eZ(e){return B(JSON.stringify({version:2,heartbeats:e})).length}eB(new ea("platform-logger",e=>new eD(e),"PRIVATE")),eB(new ea("heartbeat",e=>new eY(e),"PRIVATE")),eq(eN,ek,""),eq(eN,ek,"esm2017"),eq("fire-js",""),eq("firebase","11.8.0","app");var e0="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==T?T:"undefined"!=typeof self?self:{},e1={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}var t=function(){this.blockSize=-1};function n(){}function r(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+0xd76aa478|0;a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[1]+0xe8c7b756|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[2]+0x242070db|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[3]+0xc1bdceee|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[4]+0xf57c0faf|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[5]+0x4787c62a|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[6]+0xa8304613|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[7]+0xfd469501|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[8]+0x698098d8|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[9]+0x8b44f7af|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[10]+0xffff5bb1|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[11]+0x895cd7be|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[12]+0x6b901122|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[13]+0xfd987193|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[14]+0xa679438e|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(a<<22|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,a=t+((n=i+(a<<20|a>>>12))^i^s)+r[5]+0xfffa3942|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[11]+0x6d9d6122|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[14]+0xfde5380c|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[1]+0xa4beea44|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[7]+0xf6bb4b60|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[10]+0xbebfbc70|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[13]+0x289b7ec6|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[3]+0xd4ef3085|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[6]+0x4881d05|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[9]+0xd9d4d039|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[15]+0x1fa27cf8|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(a<<23|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)},e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,i=this.B,s=this.h,a=0;a<t;){if(0==s)for(;a<=n;)r(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){r(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){r(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var s,l={};function u(e){var t;return -128<=e&&128>e?(t=function(e){return new i([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new i([0|e],0>e?-1:0)}function h(e){if(isNaN(e)||!isFinite(e))return c;if(0>e)return m(h(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new i(t,0)}var c=u(0),f=u(1),d=u(0x1000000);function p(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return -1==e.h}function m(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(f)}function y(e,t){return e.add(m(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function w(e,t){this.g=e,this.h=t}function b(e,t){if(p(t))throw Error("division by zero");if(p(e))return new w(c,c);if(g(e))return t=b(m(e),t),new w(m(t.g),m(t.h));if(g(t))return t=b(e,m(t)),new w(m(t.g),t.h);if(30<e.g.length){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var n=f,r=t;0>=r.l(e);)n=E(n),r=E(r);var i=_(n,1),s=_(r,1);for(r=_(r,2),n=_(n,2);!p(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=_(r,1),n=_(n,1)}return t=y(e,i.j(t)),new w(i,t)}for(i=c;0<=e.l(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,r-48),a=(s=h(n)).j(t);g(a)||0<a.l(e);)n-=r,a=(s=h(n)).j(t);p(s)&&(s=f),i=i.add(s),e=y(e,a)}return new w(i,e)}function E(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function _(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,s=[],a=0;a<r;a++)s[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new i(s,e.h)}(s=i.prototype).m=function(){if(g(this))return-m(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:0x100000000+r)*t,t*=0x100000000}return e},s.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(g(this))return"-"+m(this).toString(e);for(var t=h(Math.pow(e,6)),n=this,r="";;){var i=b(n,t).g,s=((0<(n=y(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(p(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},s.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return g(e=y(this,e))?-1:+!p(e)},s.abs=function(){return g(this)?m(this):this},s.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,s=0;s<=t;s++){var a=r+(65535&this.i(s))+(65535&e.i(s)),o=(a>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);r=o>>>16,a&=65535,o&=65535,n[s]=o<<16|a}return new i(n,-0x80000000&n[n.length-1]?-1:0)},s.j=function(e){if(p(this)||p(e))return c;if(g(this))return g(e)?m(this).j(m(e)):m(m(this).j(e));if(g(e))return m(this.j(m(e)));if(0>this.l(d)&&0>e.l(d))return h(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<e.g.length;s++){var a=this.i(r)>>>16,o=65535&this.i(r),l=e.i(s)>>>16,u=65535&e.i(s);n[2*r+2*s]+=o*u,v(n,2*r+2*s),n[2*r+2*s+1]+=a*u,v(n,2*r+2*s+1),n[2*r+2*s+1]+=o*l,v(n,2*r+2*s+1),n[2*r+2*s+2]+=a*l,v(n,2*r+2*s+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new i(n,0)},s.A=function(e){return b(this,e).h},s.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},s.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},s.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,o=e1.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.A,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=h,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return m(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=h(Math.pow(n,8)),i=c,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n);8>a?(a=h(Math.pow(n,a)),i=i.j(a).add(h(o))):i=(i=i.j(r)).add(h(o))}return i},a=e1.Integer=i}).apply(void 0!==e0?e0:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var e2="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==T?T:"undefined"!=typeof self?self:{},e6={};(function(){var e,t,n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof e2&&e2];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var n=i;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in n))break e;n=n[a]}(t=t(s=n[e=e[e.length-1]]))!=s&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){var e,t,n,r,i;return e=this,t=function(e,t){return t},e instanceof String&&(e+=""),n=0,r=!1,(i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return i},i}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function m(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function y(e,t,n){return e.call.apply(e.bind,arguments)}function v(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function w(e,t,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:v).apply(null,arguments)}function b(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function E(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function _(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function T(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(o(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function I(e){return/^[\s\xa0]*$/.test(e)}function C(){var e=a.navigator;return e&&(e=e.userAgent)?e:""}function S(e){return S[" "](e),e}S[" "]=function(){};var A=-1!=C().indexOf("Gecko")&&(-1==C().toLowerCase().indexOf("webkit")||-1!=C().indexOf("Edge"))&&-1==C().indexOf("Trident")&&-1==C().indexOf("MSIE")&&-1==C().indexOf("Edge");function x(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function D(e){let t={};for(let n in e)t[n]=e[n];return t}let N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<N.length;t++)n=N[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}var R=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new L,e=>e.reset());class L{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let O,M=!1,P=new class{constructor(){this.h=this.g=null}add(e,t){let n=R.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},V=()=>{let e=a.Promise.resolve(void 0);O=()=>{e.then(U)}};var U=()=>{let e;for(var t;e=null,P.g&&(e=P.g,P.g=P.g.next,P.g||(P.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}R.j(t),100>R.h&&(R.h++,t.next=R.g,R.g=t)}M=!1};function B(){this.s=this.s,this.C=this.C}function F(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}B.prototype.s=!1,B.prototype.ma=function(){this.s||(this.s=!0,this.N())},B.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},F.prototype.h=function(){this.defaultPrevented=!0};var j=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function $(e,t){if(F.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(A){e:{try{S(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:q[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&$.aa.h.call(this)}}E($,F);var q={2:"touch",3:"pen",4:"mouse"};$.prototype.h=function(){$.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var z="closure_listenable_"+(1e6*Math.random()|0),G=0;function H(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++G,this.da=this.fa=!1}function K(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Q(e){this.src=e,this.g={},this.h=0}function W(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(K(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Y(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}Q.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=Y(e,t,r,i);return -1<a?(t=e[a],n||(t.fa=!1)):((t=new H(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var X="closure_lm_"+(1e6*Math.random()|0),J={};function Z(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=m(i)?!!i.capture:!!i,o=er(e);if(o||(e[X]=o=new Q(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return en.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)j||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(et(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function ee(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[z])W(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(et(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=er(t))?(W(n,e),0==n.h&&(n.src=null,t[X]=null)):K(e)}}}function et(e){return e in J?J[e]:J[e]="on"+e}function en(e,t){if(e.da)e=!0;else{t=new $(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&ee(e),e=n.call(r,t)}return e}function er(e){return(e=e[X])instanceof Q?e:null}var ei="__closure_events_fn_"+(1e9*Math.random()>>>0);function es(e){return"function"==typeof e?e:(e[ei]||(e[ei]=function(t){return e.handleEvent(t)}),e[ei])}function ea(){B.call(this),this.i=new Q(this),this.M=this,this.F=null}function eo(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new F(t,e);else if(t instanceof F)t.target=t.target||e;else{var i=t;k(t=new F(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=el(a,r,!0,t)&&i}if(i=el(a=t.g=e,r,!0,t)&&i,i=el(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=el(a=t.g=n[s],r,!1,t)&&i}function el(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.da&&a.capture==n){var o=a.listener,l=a.ha||a.src;a.fa&&W(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}function eu(e,t,n){if("function"==typeof e)n&&(e=w(e,n));else if(e&&"function"==typeof e.handleEvent)e=w(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:a.setTimeout(e,t||0)}E(ea,B),ea.prototype[z]=!0,ea.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else(i=m(i)?!!i.capture:!!i,r=es(r),t&&t[z])?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=Y(a=t.g[n],r,i,s))&&(K(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=er(t))&&(n=t.g[n.toString()],t=-1,n&&(t=Y(n,r,i,s)),(r=-1<t?n[t]:null)&&ee(r))}(this,e,t,n,r)},ea.prototype.N=function(){if(ea.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)K(n[r]);delete t.g[e],t.h--}}this.F=null},ea.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ea.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class eh extends B{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=eu(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ec(e){B.call(this),this.h=e,this.g={}}E(ec,B);var ef=[];function ed(e){x(e.g,function(e,t){this.g.hasOwnProperty(t)&&ee(e)},e),e.g={}}ec.prototype.N=function(){ec.aa.N.call(this),ed(this)},ec.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ep=a.JSON.stringify,eg=a.JSON.parse,em=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ey(){}function ev(e){return e.h||(e.h=e.i())}function ew(){}ey.prototype.h=null;var eb={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eE(){F.call(this,"d")}function e_(){F.call(this,"c")}E(eE,F),E(e_,F);var eT={},eI=null;function eC(){return eI=eI||new ea}function eS(e){F.call(this,eT.La,e)}function eA(e){let t=eC();eo(t,new eS(t))}function ex(e,t){F.call(this,eT.STAT_EVENT,e),this.stat=t}function eD(e){let t=eC();eo(t,new ex(t,e))}function eN(e,t){F.call(this,eT.Ma,e),this.size=t}function ek(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eR(){this.g=!0}function eL(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return ep(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}eT.La="serverreachability",E(eS,F),eT.STAT_EVENT="statevent",E(ex,F),eT.Ma="timingevent",E(eN,F),eR.prototype.xa=function(){this.g=!1},eR.prototype.info=function(){};var eO={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eM={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function eP(){}function eV(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ec(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new eU}function eU(){this.i=null,this.g="",this.h=!1}E(eP,ey),eP.prototype.g=function(){return new XMLHttpRequest},eP.prototype.i=function(){return{}},t=new eP;var eB={},eF={};function ej(e,t,n){e.L=1,e.v=ti(e9(t)),e.m=n,e.P=!0,e$(e,null)}function e$(e,t){e.F=Date.now(),ez(e),e.A=e9(e.v);var n,r,i,s,a,o,l=e.A,u=e.R;Array.isArray(u)||(u=[String(u)]),ty(l.i,"t",u),e.C=0,l=e.j.J,e.h=new eU,e.g=t6(e.j,l?t:null,!e.m),0<e.O&&(e.M=new eh(w(e.Y,e,e.g),e.O)),t=e.U,l=e.g,u=e.ca;var h="readystatechange";Array.isArray(h)||(h&&(ef[0]=h.toString()),h=ef);for(var c=0;c<h.length;c++){var f=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=es(r),t&&t[z]?t.L(n,r,m(i)?!!i.capture:!!i,s):Z(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=es(r),t&&t[z]?t.K(n,r,m(i)?!!i.capture:!!i,s):Z(t,n,r,!1,i,s)}(l,h[c],u||t.handleEvent,!1,t.h||t);if(!f)break;t.g[f.key]=f}t=e.H?D(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),eA(),n=e.i,r=e.u,i=e.A,s=e.l,a=e.R,o=e.m,n.info(function(){if(n.g)if(o)for(var e="",t=o.split("&"),l=0;l<t.length;l++){var u=t[l].split("=");if(1<u.length){var h=u[0];u=u[1];var c=h.split("_");e=2<=c.length&&"type"==c[1]?e+(h+"=")+u+"&":e+(h+"=redacted&")}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+r+"\n"+i+"\n"+e})}function eq(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function ez(e){e.S=Date.now()+e.I,eG(e,e.I)}function eG(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=ek(w(e.ba,e),t)}function eH(e){e.B&&(a.clearTimeout(e.B),e.B=null)}function eK(e){0==e.j.G||e.J||tJ(e.j,e)}function eQ(e){eH(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ed(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function eW(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||e0(n.h,e))){if(!e.K&&e0(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g)if(n.g.F+3e3<e.F)tX(n),tj(n);else break e;tQ(n),eD(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=ek(w(n.Za,n),6e3));if(1>=eZ(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else t0(n,11)}else if((e.K||n.g==e)&&tX(n),!I(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let o=i[t];if(n.T=o[0],o=o[1],2==n.G)if("c"==o[0]){n.K=o[1],n.ia=o[2];let t=o[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));let i=o[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(n.L=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(e1(s,s.h),s.h=null))}if(r.D){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,tr(r.I,r.D,e))}}if(n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms")),(r=n).qa=t2(r,r.J?r.ia:null,r.W),e.K){e3(r.h,e);var a=r.L;a&&(e.I=a),e.B&&(eH(e),ez(e)),r.g=e}else tK(r);0<n.i.length&&tq(n)}else"stop"!=o[0]&&"close"!=o[0]||t0(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?t0(n,7):tF(n):"noop"!=o[0]&&n.l&&n.l.ta(o),n.v=0)}}eA(4)}catch(e){}}eV.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==tP(e)?t.j():this.Y(e)},eV.prototype.Y=function(e){try{if(e==this.g)e:{let v=tP(this.g);var t=this.g.Ba();let w=this.g.Z();if(!(3>v)&&(3!=v||this.g&&(this.h.h||this.g.oa()||tV(this.g)))){this.J||4!=v||7==t||(8==t||0>=w?eA(3):eA(2)),eH(this);var n=this.g.Z();this.X=n;t:if(eq(this)){var r=tV(this.g);e="";var i=r.length,s=4==tP(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){eQ(this),eK(this);var o="";break t}this.h.i=new a.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==i-1)});r.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,l=this.i,u=this.u,h=this.A,c=this.l,f=this.R,d=n,l.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+f+"]: "+u+"\n"+h+"\n"+v+" "+d}),this.o){if(this.T&&!this.K){t:{if(this.g){var l,u,h,c,f,d,p,g=this.g;if((p=g.g?g.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(p)){var m=p;break t}}m=null}if(n=m)eL(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,eW(this,n);else{this.o=!1,this.s=3,eD(12),eQ(this),eK(this);break e}}if(this.P){let e;for(n=!0;!this.J&&this.C<o.length;)if((e=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?eF:isNaN(n=Number(t.substring(n,r)))?eB:(r+=1)+n>t.length?eF:(t=t.slice(r,r+n),e.C=r+n,t)}(this,o))==eF){4==v&&(this.s=4,eD(14),n=!1),eL(this.i,this.l,null,"[Incomplete Response]");break}else if(e==eB){this.s=4,eD(15),eL(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}else eL(this.i,this.l,e,null),eW(this,e);if(eq(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=v||0!=o.length||this.h.h||(this.s=1,eD(16),n=!1),this.o=this.o&&n,n){if(0<o.length&&!this.W){this.W=!0;var y=this.j;y.g==this&&y.ba&&!y.M&&(y.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),tW(y),y.M=!0,eD(11))}}else eL(this.i,this.l,o,"[Invalid Chunked Response]"),eQ(this),eK(this)}else eL(this.i,this.l,o,null),eW(this,o);4==v&&eQ(this),this.o&&!this.J&&(4==v?tJ(this.j,this):(this.o=!1,ez(this)))}else(function(e){let t={};e=(e.g&&2<=tP(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(I(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,eD(12)):(this.s=0,eD(13)),eQ(this),eK(this)}}}catch(e){}finally{}},eV.prototype.cancel=function(){this.J=!0,eQ(this)},eV.prototype.ba=function(){var e,t;this.B=null;let n=Date.now();0<=n-this.S?(e=this.i,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(eA(),eD(17)),eQ(this),this.s=2,eK(this)):eG(this,this.S-n)};var eY=class{constructor(e,t){this.g=e,this.map=t}};function eX(e){this.l=e||10,e=a.PerformanceNavigationTiming?0<(e=a.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function eJ(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eZ(e){return e.h?1:e.g?e.g.size:0}function e0(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function e1(e,t){e.g?e.g.add(t):e.h=t}function e3(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e5(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.D);return t}return _(e.i)}function e4(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(o(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(o(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(o(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}eX.prototype.cancel=function(){if(this.i=e5(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e8=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e7(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof e7){this.h=e.h,te(this,e.j),this.o=e.o,this.g=e.g,tt(this,e.s),this.l=e.l;var t=e.i,n=new td;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),tn(this,n),this.m=e.m}else e&&(t=String(e).match(e8))?(this.h=!1,te(this,t[1]||"",!0),this.o=ts(t[2]||""),this.g=ts(t[3]||"",!0),tt(this,t[4]),this.l=ts(t[5]||"",!0),tn(this,t[6]||"",!0),this.m=ts(t[7]||"")):(this.h=!1,this.i=new td(null,this.h))}function e9(e){return new e7(e)}function te(e,t,n){e.j=n?ts(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function tt(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function tn(e,t,n){var r,i;t instanceof td?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(tp(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tg(this,t),ty(this,n,e))},r)),r.j=i):(n||(t=ta(t,tc)),e.i=new td(t,e.h))}function tr(e,t,n){e.i.set(t,n)}function ti(e){return tr(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function ts(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ta(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,to),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function to(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e7.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ta(t,tl,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ta(t,tl,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ta(n,"/"==n.charAt(0)?th:tu,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ta(n,tf)),e.join("")};var tl=/[#\/\?@]/g,tu=/[#\?:]/g,th=/[#\?]/g,tc=/[#\?@]/g,tf=/#/g;function td(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tp(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tg(e,t){tp(e),t=tv(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tm(e,t){return tp(e),t=tv(e,t),e.g.has(t)}function ty(e,t,n){tg(e,t),0<n.length&&(e.i=null,e.g.set(tv(e,t),_(n)),e.h+=n.length)}function tv(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tw(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tb(){this.g=new em}function tE(e){this.l=e.Ub||null,this.j=e.eb||!1}function t_(e,t){ea.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function tT(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tI(e){e.readyState=4,e.l=null,e.j=null,e.v=null,tC(e)}function tC(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tS(e){let t="";return x(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tA(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tS(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tr(e,t,n))}function tx(e){ea.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(n=td.prototype).add=function(e,t){tp(this),this.i=null,e=tv(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},n.forEach=function(e,t){tp(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},n.na=function(){tp(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},n.V=function(e){tp(this);let t=[];if("string"==typeof e)tm(this,e)&&(t=t.concat(this.g.get(tv(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},n.set=function(e,t){return tp(this),this.i=null,tm(this,e=tv(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},n.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),a=this.V(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")},E(tE,ey),tE.prototype.g=function(){return new t_(this.l,this.j)},tE.prototype.i=(e={},function(){return e}),E(t_,ea),(n=t_.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,tC(this)},n.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||a).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tI(this)),this.readyState=0},n.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tC(this)),this.g&&(this.readyState=3,tC(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;tT(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},n.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tI(this):tC(this),3==this.readyState&&tT(this)}},n.Ra=function(e){this.g&&(this.response=this.responseText=e,tI(this))},n.Qa=function(e){this.g&&(this.response=e,tI(this))},n.ga=function(){this.g&&tI(this)},n.setRequestHeader=function(e,t){this.u.append(e,t)},n.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(t_.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),E(tx,ea);var tD=/^https?$/i,tN=["POST","PUT"];function tk(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,tR(e),tO(e)}function tR(e){e.A||(e.A=!0,eo(e,"complete"),eo(e,"error"))}function tL(e){if(e.h&&void 0!==s&&(!e.v[1]||4!=tP(e)||2!=e.Z())){if(e.u&&4==tP(e))eu(e.Ea,0,e);else if(eo(e,"readystatechange"),4==tP(e)){e.h=!1;try{let s=e.Z();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===s){var i=String(e.D).match(e8)[1]||null;!i&&a.self&&a.self.location&&(i=a.self.location.protocol.slice(0,-1)),n=!tD.test(i?i.toLowerCase():"")}t=n}if(t)eo(e,"complete"),eo(e,"success");else{e.m=6;try{var o=2<tP(e)?e.g.statusText:""}catch(e){o=""}e.l=o+" ["+e.Z()+"]",tR(e)}}finally{tO(e)}}}}function tO(e,t){if(e.g){tM(e);let n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||eo(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function tM(e){e.I&&(a.clearTimeout(e.I),e.I=null)}function tP(e){return e.g?e.g.readyState:0}function tV(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tU(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tB(e){this.Aa=0,this.i=[],this.j=new eR,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tU("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tU("baseRetryDelayMs",5e3,e),this.cb=tU("retryDelaySeedMs",1e4,e),this.Wa=tU("forwardChannelMaxRetries",2,e),this.wa=tU("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new eX(e&&e.concurrentRequestLimit),this.Da=new tb,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tF(e){if(t$(e),3==e.G){var t=e.U++,n=e9(e.I);if(tr(n,"SID",e.K),tr(n,"RID",t),tr(n,"TYPE","terminate"),tG(e,n),(t=new eV(e,e.j,t)).L=2,t.v=ti(e9(n)),n=!1,a.navigator&&a.navigator.sendBeacon)try{n=a.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&a.Image&&((new Image).src=t.v,n=!0),n||(t.g=t6(t.j,null),t.g.ea(t.v)),t.F=Date.now(),ez(t)}t1(e)}function tj(e){e.g&&(tW(e),e.g.cancel(),e.g=null)}function t$(e){tj(e),e.u&&(a.clearTimeout(e.u),e.u=null),tX(e),e.h.cancel(),e.s&&("number"==typeof e.s&&a.clearTimeout(e.s),e.s=null)}function tq(e){if(!eJ(e.h)&&!e.s){e.s=!0;var t=e.Ga;O||V(),M||(O(),M=!0),P.add(t,e),e.B=0}}function tz(e,t){var n;n=t?t.l:e.U++;let r=e9(e.I);tr(r,"SID",e.K),tr(r,"RID",n),tr(r,"AID",e.T),tG(e,r),e.m&&e.o&&tA(r,e.m,e.o),n=new eV(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tH(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),e1(e.h,n),ej(n,r,t)}function tG(e,t){e.H&&x(e.H,function(e,n){tr(t,n,e)}),e.l&&e4({},function(e,n){tr(t,n,e)})}function tH(e,t,n){n=Math.min(e.i.length,n);var r=e.l?w(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g,o=i[a].map;if(0>(n-=t))t=Math.max(0,i[a].g-100),s=!1;else try{!function(e,t,n){let r=n||"";try{e4(e,function(e,n){let i=e;m(e)&&(i=ep(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+n+"_")}catch(e){r&&r(o)}}if(s){r=e.join("&");break e}}}return t.D=e=e.i.splice(0,n),r}function tK(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;O||V(),M||(O(),M=!0),P.add(t,e),e.v=0}}function tQ(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=ek(w(e.Fa,e),tZ(e,e.v)),e.v++,!0)}function tW(e){null!=e.A&&(a.clearTimeout(e.A),e.A=null)}function tY(e){e.g=new eV(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=e9(e.qa);tr(t,"RID","rpc"),tr(t,"SID",e.K),tr(t,"AID",e.T),tr(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&tr(t,"TO",e.ja),tr(t,"TYPE","xmlhttp"),tG(e,t),e.m&&e.o&&tA(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ti(e9(t)),n.m=null,n.P=!0,e$(n,e)}function tX(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tJ(e,t){var n,r=null;if(e.g==t){tX(e),tW(e),e.g=null;var i=2}else{if(!e0(e.h,t))return;r=t.D,e3(e.h,t),i=1}if(0!=e.G){if(t.o)if(1==i){r=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;eo(i=eC(),new eN(i,r)),tq(e)}else tK(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==i&&(n=t,!(eZ(e.h)>=e.h.j-!!e.s)&&(e.s?(e.i=n.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=ek(w(e.Ga,e,n),tZ(e,e.B)),e.B++,!0)))||2==i&&tQ(e)))switch(r&&0<r.length&&((t=e.h).i=t.i.concat(r)),s){case 1:t0(e,5);break;case 4:t0(e,10);break;case 3:t0(e,6);break;default:t0(e,2)}}}function tZ(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function t0(e,t){if(e.j.info("Error code "+t),2==t){var n=w(e.fb,e),r=e.Xa;let t=!r;r=new e7(r||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||te(r,"https"),ti(r),t?function(e,t){let n=new eR;if(a.Image){let r=new Image;r.onload=b(tw,n,"TestLoadImage: loaded",!0,t,r),r.onerror=b(tw,n,"TestLoadImage: error",!1,t,r),r.onabort=b(tw,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=b(tw,n,"TestLoadImage: timeout",!1,t,r),a.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){let n=new eR,r=new AbortController,i=setTimeout(()=>{r.abort(),tw(n,"TestPingServer: timeout",!1,t)},1e4);fetch(e,{signal:r.signal}).then(e=>{clearTimeout(i),e.ok?tw(n,"TestPingServer: ok",!0,t):tw(n,"TestPingServer: server error",!1,t)}).catch(()=>{clearTimeout(i),tw(n,"TestPingServer: error",!1,t)})}(r.toString(),n)}else eD(2);e.G=0,e.l&&e.l.sa(t),t1(e),t$(e)}function t1(e){if(e.G=0,e.ka=[],e.l){let t=e5(e.h);(0!=t.length||0!=e.i.length)&&(T(e.ka,t),T(e.ka,e.i),e.h.i.length=0,_(e.i),e.i.length=0),e.l.ra()}}function t2(e,t,n){var r=n instanceof e7?e9(n):new e7(n);if(""!=r.g)t&&(r.g=t+"."+r.g),tt(r,r.s);else{var i=a.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new e7(null);r&&te(s,r),t&&(s.g=t),i&&tt(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&tr(r,n,t),tr(r,"VER",e.la),tG(e,r),r}function t6(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tx(e.Ca&&!e.pa?new tE({eb:n}):e.pa)).Ha(e.J),t}function t3(){}function t5(){}function t4(e,t){ea.call(this),this.g=new tB(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!I(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!I(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t9(this)}function t8(e){eE.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t7(){e_.call(this),this.status=1}function t9(e){this.g=e}(n=tx.prototype).Ha=function(e){this.J=e},n.ea=function(e,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);n=n?n.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():t.g(),this.v=this.o?ev(this.o):ev(t),this.g.onreadystatechange=w(this.Ea,this);try{this.B=!0,this.g.open(n,String(e),!0),this.B=!1}catch(e){tk(this,e);return}if(e=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[t,o]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&e instanceof a.FormData,!(0<=Array.prototype.indexOf.call(tN,n,void 0))||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(t,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tM(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){tk(this,e)}},n.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,eo(this,"complete"),eo(this,"abort"),tO(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tO(this,!0)),tx.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?tL(this):this.bb())},n.bb=function(){tL(this)},n.isActive=function(){return!!this.g},n.Z=function(){try{return 2<tP(this)?this.g.status:-1}catch(e){return -1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},n.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eg(t)}},n.Ba=function(){return this.m},n.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(n=tB.prototype).la=8,n.G=1,n.connect=function(e,t,n,r){eD(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=t2(this,null,this.W),tq(this)},n.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let i=new eV(this,this.j,e),s=this.o;if(this.S&&(s?k(s=D(s),this.S):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tH(this,i,t),tr(n=e9(this.I),"RID",e),tr(n,"CVER",22),this.D&&tr(n,"X-HTTP-Session-Id",this.D),tG(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(tS(s)))+"&"+t:this.m&&tA(n,this.m,s)),e1(this.h,i),this.Ua&&tr(n,"TYPE","init"),this.P?(tr(n,"$req",t),tr(n,"SID","null"),i.T=!0,ej(i,n,null)):ej(i,n,t),this.G=2}}else 3==this.G&&(e?tz(this,e):0==this.i.length||eJ(this.h)||tz(this))},n.Fa=function(){if(this.u=null,tY(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=ek(w(this.ab,this),e)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,eD(10),tj(this),tY(this))},n.Za=function(){null!=this.C&&(this.C=null,tj(this),tQ(this),eD(19))},n.fb=function(e){e?(this.j.info("Successfully pinged google.com"),eD(2)):(this.j.info("Failed to ping google.com"),eD(1))},n.isActive=function(){return!!this.l&&this.l.isActive(this)},(n=t3.prototype).ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){},t5.prototype.g=function(e,t){return new t4(e,t)},E(t4,ea),t4.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},t4.prototype.close=function(){tF(this.g)},t4.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=ep(e),e=n);t.i.push(new eY(t.Ya++,e)),3==t.G&&tq(t)},t4.prototype.N=function(){this.g.l=null,delete this.j,tF(this.g),delete this.g,t4.aa.N.call(this)},E(t8,eE),E(t7,e_),E(t9,t3),t9.prototype.ua=function(){eo(this.g,"a")},t9.prototype.ta=function(e){eo(this.g,new t8(e))},t9.prototype.sa=function(e){eo(this.g,new t7)},t9.prototype.ra=function(){eo(this.g,"b")},t5.prototype.createWebChannel=t5.prototype.g,t4.prototype.send=t4.prototype.o,t4.prototype.open=t4.prototype.m,t4.prototype.close=t4.prototype.close,g=e6.createWebChannelTransport=function(){return new t5},p=e6.getStatEventTarget=function(){return eC()},d=e6.Event=eT,f=e6.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eO.NO_ERROR=0,eO.TIMEOUT=8,eO.HTTP_ERROR=6,c=e6.ErrorCode=eO,eM.COMPLETE="complete",h=e6.EventType=eM,ew.EventType=eb,eb.OPEN="a",eb.CLOSE="b",eb.ERROR="c",eb.MESSAGE="d",ea.prototype.listen=ea.prototype.K,u=e6.WebChannel=ew,e6.FetchXmlHttpFactory=tE,tx.prototype.listenOnce=tx.prototype.L,tx.prototype.getLastError=tx.prototype.Ka,tx.prototype.getLastErrorCode=tx.prototype.Ba,tx.prototype.getStatus=tx.prototype.Z,tx.prototype.getResponseJson=tx.prototype.Oa,tx.prototype.getResponseText=tx.prototype.oa,tx.prototype.send=tx.prototype.ea,tx.prototype.setWithCredentials=tx.prototype.Ha,l=e6.XhrIo=tx}).apply(void 0!==e2?e2:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),m=function(e){for(var t,n=e.length,r=n%3,i=[],s=0,a=n-r;s<a;s+=16383)i.push(function(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&0xff0000)+(e[s+1]<<8&65280)+(255&e[s+2]),i.push(e3[r>>18&63]+e3[r>>12&63]+e3[r>>6&63]+e3[63&r]);return i.join("")}(e,s,s+16383>a?a:s+16383));return 1===r?i.push(e3[(t=e[n-1])>>2]+e3[t<<4&63]+"=="):2===r&&i.push(e3[(t=(e[n-2]<<8)+e[n-1])>>10]+e3[t>>4&63]+e3[t<<2&63]+"="),i.join("")};for(var e3=[],e5=[],e4="undefined"!=typeof Uint8Array?Uint8Array:Array,e8="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e7=0,e9=e8.length;e7<e9;++e7)e3[e7]=e8[e7],e5[e8.charCodeAt(e7)]=e7;e5[45]=62,e5[95]=63,y=function(e,t,n,r,i){var s,a,o=8*i-r-1,l=(1<<o)-1,u=l>>1,h=-7,c=n?i-1:0,f=n?-1:1,d=e[t+c];for(c+=f,s=d&(1<<-h)-1,d>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=f,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=r;h>0;a=256*a+e[t+c],c+=f,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,r),s-=u}return(d?-1:1)*a*Math.pow(2,s-r)},v=function(e,t,n,r,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,f=5960464477539062e-23*(23===i),d=r?0:s-1,p=r?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=f/l:t+=f*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[n+d]=255&o,d+=p,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[n+d]=255&a,d+=p,a/=256,u-=8);e[n+d-p]|=128*g};const te="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function tt(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,tn.prototype),t}function tn(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return ts(e)}return tr(e,t,n)}function tr(e,t,n){if("string"==typeof e){var r=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!tn.isEncoding(i))throw TypeError("Unknown encoding: "+i);let n=0|tu(r,i),s=tt(n),a=s.write(r,i);return a!==n&&(s=s.slice(0,a)),s}if(ArrayBuffer.isView(e)){var s=e;if(tR(s,Uint8Array)){let e=new Uint8Array(s);return to(e.buffer,e.byteOffset,e.byteLength)}return ta(s)}if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(tR(e,ArrayBuffer)||e&&tR(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(tR(e,SharedArrayBuffer)||e&&tR(e.buffer,SharedArrayBuffer)))return to(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let a=e.valueOf&&e.valueOf();if(null!=a&&a!==e)return tn.from(a,t,n);let o=function(e){if(tn.isBuffer(e)){let t=0|tl(e.length),n=tt(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?tt(0):ta(e):"Buffer"===e.type&&Array.isArray(e.data)?ta(e.data):void 0}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return tn.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function ti(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function ts(e){return ti(e),tt(e<0?0:0|tl(e))}function ta(e){let t=e.length<0?0:0|tl(e.length),n=tt(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function to(e,t,n){let r;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),tn.prototype),r}function tl(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function tu(e,t){if(tn.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||tR(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return tD(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return tN(e).length;default:if(i)return r?-1:tD(e).length;t=(""+t).toLowerCase(),i=!0}}function th(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){let r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let r=t;r<n;++r)i+=tL[e[r]];return i}(this,t,n);case"utf8":case"utf-8":return tp(this,t,n);case"ascii":return function(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}(this,t,n);case"latin1":case"binary":return function(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}(this,t,n);case"base64":var i,s,a;return i=this,s=t,a=n,0===s&&a===i.length?m(i):m(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){let r=e.slice(t,n),i="";for(let e=0;e<r.length-1;e+=2)i+=String.fromCharCode(r[e]+256*r[e+1]);return i}(this,t,n);default:if(r)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function tc(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function tf(e,t,n,r,i){var s;if(0===e.length)return -1;if("string"==typeof n?(r=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(i)return -1;else n=e.length-1;else if(n<0)if(!i)return -1;else n=0;if("string"==typeof t&&(t=tn.from(t,r)),tn.isBuffer(t))return 0===t.length?-1:td(e,t,n,r,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return td(e,[t],n,r,i)}throw TypeError("val must be string, number or Buffer")}function td(e,t,n,r,i){let s,a=1,o=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){let r=-1;for(s=n;s<o;s++)if(u(e,s)===u(t,-1===r?0:s-r)){if(-1===r&&(r=s),s-r+1===l)return r*a}else -1!==r&&(s-=s-r),r=-1}else for(n+l>o&&(n=o-l),s=n;s>=0;s--){let n=!0;for(let r=0;r<l;r++)if(u(e,s+r)!==u(t,r)){n=!1;break}if(n)return s}return -1}function tp(e,t,n){n=Math.min(e.length,n);let r=[],i=t;for(;i<n;){let t=e[i],s=null,a=t>239?4:t>223?3:t>191?2:1;if(i+a<=n){let n,r,o,l;switch(a){case 1:t<128&&(s=t);break;case 2:(192&(n=e[i+1]))==128&&(l=(31&t)<<6|63&n)>127&&(s=l);break;case 3:n=e[i+1],r=e[i+2],(192&n)==128&&(192&r)==128&&(l=(15&t)<<12|(63&n)<<6|63&r)>2047&&(l<55296||l>57343)&&(s=l);break;case 4:n=e[i+1],r=e[i+2],o=e[i+3],(192&n)==128&&(192&r)==128&&(192&o)==128&&(l=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&o)>65535&&l<1114112&&(s=l)}}null===s?(s=65533,a=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=a}var s=r;let a=s.length;if(a<=4096)return String.fromCharCode.apply(String,s);let o="",l=0;for(;l<a;)o+=String.fromCharCode.apply(String,s.slice(l,l+=4096));return o}function tg(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function tm(e,t,n,r,i,s){if(!tn.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(n+r>e.length)throw RangeError("Index out of range")}function ty(e,t,n,r,i){tC(t,r,i,e,n,7);let s=Number(t&BigInt(0xffffffff));e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s;let a=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,n}function tv(e,t,n,r,i){tC(t,r,i,e,n,7);let s=Number(t&BigInt(0xffffffff));e[n+7]=s,s>>=8,e[n+6]=s,s>>=8,e[n+5]=s,s>>=8,e[n+4]=s;let a=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[n+3]=a,a>>=8,e[n+2]=a,a>>=8,e[n+1]=a,a>>=8,e[n]=a,n+8}function tw(e,t,n,r,i,s){if(n+r>e.length||n<0)throw RangeError("Index out of range")}function tb(e,t,n,r,i){return t*=1,n>>>=0,i||tw(e,t,n,4,34028234663852886e22,-34028234663852886e22),v(e,t,n,r,23,4),n+4}function tE(e,t,n,r,i){return t*=1,n>>>=0,i||tw(e,t,n,8,17976931348623157e292,-17976931348623157e292),v(e,t,n,r,52,8),n+8}tn.TYPED_ARRAY_SUPPORT=function(){try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),tn.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(tn.prototype,"parent",{enumerable:!0,get:function(){if(tn.isBuffer(this))return this.buffer}}),Object.defineProperty(tn.prototype,"offset",{enumerable:!0,get:function(){if(tn.isBuffer(this))return this.byteOffset}}),tn.poolSize=8192,tn.from=function(e,t,n){return tr(e,t,n)},Object.setPrototypeOf(tn.prototype,Uint8Array.prototype),Object.setPrototypeOf(tn,Uint8Array),tn.alloc=function(e,t,n){return(ti(e),e<=0)?tt(e):void 0!==t?"string"==typeof n?tt(e).fill(t,n):tt(e).fill(t):tt(e)},tn.allocUnsafe=function(e){return ts(e)},tn.allocUnsafeSlow=function(e){return ts(e)},tn.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==tn.prototype},tn.compare=function(e,t){if(tR(e,Uint8Array)&&(e=tn.from(e,e.offset,e.byteLength)),tR(t,Uint8Array)&&(t=tn.from(t,t.offset,t.byteLength)),!tn.isBuffer(e)||!tn.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:+(r<n)},tn.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},tn.concat=function(e,t){let n;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return tn.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;let r=tn.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){let t=e[n];if(tR(t,Uint8Array))i+t.length>r.length?(tn.isBuffer(t)||(t=tn.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else if(tn.isBuffer(t))t.copy(r,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=t.length}return r},tn.byteLength=tu,tn.prototype._isBuffer=!0,tn.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)tc(this,t,t+1);return this},tn.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)tc(this,t,t+3),tc(this,t+1,t+2);return this},tn.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)tc(this,t,t+7),tc(this,t+1,t+6),tc(this,t+2,t+5),tc(this,t+3,t+4);return this},tn.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?tp(this,0,e):th.apply(this,arguments)},tn.prototype.toLocaleString=tn.prototype.toString,tn.prototype.equals=function(e){if(!tn.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===tn.compare(this,e)},tn.prototype.inspect=function(){let e="";return e=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(e+=" ... "),"<Buffer "+e+">"},te&&(tn.prototype[te]=tn.prototype.inspect),tn.prototype.compare=function(e,t,n,r,i){if(tR(e,Uint8Array)&&(e=tn.from(e,e.offset,e.byteLength)),!tn.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;let s=i-r,a=n-t,o=Math.min(s,a),l=this.slice(r,i),u=e.slice(t,n);for(let e=0;e<o;++e)if(l[e]!==u[e]){s=l[e],a=u[e];break}return s<a?-1:+(a<s)},tn.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},tn.prototype.indexOf=function(e,t,n){return tf(this,e,t,n,!0)},tn.prototype.lastIndexOf=function(e,t,n){return tf(this,e,t,n,!1)},tn.prototype.write=function(e,t,n,r){var i,s,a,o,l,u,h,c;if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let f=this.length-t;if((void 0===n||n>f)&&(n=f),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let d=!1;for(;;)switch(r){case"hex":return function(e,t,n,r){let i;n=Number(n)||0;let s=e.length-n;r?(r=Number(r))>s&&(r=s):r=s;let a=t.length;for(r>a/2&&(r=a/2),i=0;i<r;++i){var o;let r=parseInt(t.substr(2*i,2),16);if((o=r)!=o)break;e[n+i]=r}return i}(this,e,t,n);case"utf8":case"utf-8":return i=t,s=n,tk(tD(e,this.length-i),this,i,s);case"ascii":case"latin1":case"binary":return a=t,o=n,tk(function(e){let t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(e),this,a,o);case"base64":return l=t,u=n,tk(tN(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=n,tk(function(e,t){let n,r,i=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i.push(n%256),i.push(r);return i}(e,this.length-h),this,h,c);default:if(d)throw TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),d=!0}},tn.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},tn.prototype.slice=function(e,t){let n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);let r=this.subarray(e,t);return Object.setPrototypeOf(r,tn.prototype),r},tn.prototype.readUintLE=tn.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||tg(e,t,this.length);let r=this[e],i=1,s=0;for(;++s<t&&(i*=256);)r+=this[e+s]*i;return r},tn.prototype.readUintBE=tn.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||tg(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},tn.prototype.readUint8=tn.prototype.readUInt8=function(e,t){return e>>>=0,t||tg(e,1,this.length),this[e]},tn.prototype.readUint16LE=tn.prototype.readUInt16LE=function(e,t){return e>>>=0,t||tg(e,2,this.length),this[e]|this[e+1]<<8},tn.prototype.readUint16BE=tn.prototype.readUInt16BE=function(e,t){return e>>>=0,t||tg(e,2,this.length),this[e]<<8|this[e+1]},tn.prototype.readUint32LE=tn.prototype.readUInt32LE=function(e,t){return e>>>=0,t||tg(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},tn.prototype.readUint32BE=tn.prototype.readUInt32BE=function(e,t){return e>>>=0,t||tg(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},tn.prototype.readBigUInt64LE=tO(function(e){tS(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&tA(e,this.length-8);let r=t+256*this[++e]+65536*this[++e]+0x1000000*this[++e],i=this[++e]+256*this[++e]+65536*this[++e]+0x1000000*n;return BigInt(r)+(BigInt(i)<<BigInt(32))}),tn.prototype.readBigUInt64BE=tO(function(e){tS(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&tA(e,this.length-8);let r=0x1000000*t+65536*this[++e]+256*this[++e]+this[++e],i=0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)}),tn.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||tg(e,t,this.length);let r=this[e],i=1,s=0;for(;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},tn.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||tg(e,t,this.length);let r=t,i=1,s=this[e+--r];for(;r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},tn.prototype.readInt8=function(e,t){return(e>>>=0,t||tg(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},tn.prototype.readInt16LE=function(e,t){e>>>=0,t||tg(e,2,this.length);let n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},tn.prototype.readInt16BE=function(e,t){e>>>=0,t||tg(e,2,this.length);let n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},tn.prototype.readInt32LE=function(e,t){return e>>>=0,t||tg(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},tn.prototype.readInt32BE=function(e,t){return e>>>=0,t||tg(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},tn.prototype.readBigInt64LE=tO(function(e){tS(e>>>=0,"offset");let t=this[e],n=this[e+7];return(void 0===t||void 0===n)&&tA(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24))<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+0x1000000*this[++e])}),tn.prototype.readBigInt64BE=tO(function(e){tS(e>>>=0,"offset");let t=this[e],n=this[e+7];return(void 0===t||void 0===n)&&tA(e,this.length-8),(BigInt((t<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n)}),tn.prototype.readFloatLE=function(e,t){return e>>>=0,t||tg(e,4,this.length),y(this,e,!0,23,4)},tn.prototype.readFloatBE=function(e,t){return e>>>=0,t||tg(e,4,this.length),y(this,e,!1,23,4)},tn.prototype.readDoubleLE=function(e,t){return e>>>=0,t||tg(e,8,this.length),y(this,e,!0,52,8)},tn.prototype.readDoubleBE=function(e,t){return e>>>=0,t||tg(e,8,this.length),y(this,e,!1,52,8)},tn.prototype.writeUintLE=tn.prototype.writeUIntLE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){let r=Math.pow(2,8*n)-1;tm(this,e,t,n,r,0)}let i=1,s=0;for(this[t]=255&e;++s<n&&(i*=256);)this[t+s]=e/i&255;return t+n},tn.prototype.writeUintBE=tn.prototype.writeUIntBE=function(e,t,n,r){if(e*=1,t>>>=0,n>>>=0,!r){let r=Math.pow(2,8*n)-1;tm(this,e,t,n,r,0)}let i=n-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+n},tn.prototype.writeUint8=tn.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||tm(this,e,t,1,255,0),this[t]=255&e,t+1},tn.prototype.writeUint16LE=tn.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||tm(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},tn.prototype.writeUint16BE=tn.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||tm(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},tn.prototype.writeUint32LE=tn.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||tm(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},tn.prototype.writeUint32BE=tn.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||tm(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},tn.prototype.writeBigUInt64LE=tO(function(e,t=0){return ty(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),tn.prototype.writeBigUInt64BE=tO(function(e,t=0){return tv(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),tn.prototype.writeIntLE=function(e,t,n,r){if(e*=1,t>>>=0,!r){let r=Math.pow(2,8*n-1);tm(this,e,t,n,r-1,-r)}let i=0,s=1,a=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s|0)-a&255;return t+n},tn.prototype.writeIntBE=function(e,t,n,r){if(e*=1,t>>>=0,!r){let r=Math.pow(2,8*n-1);tm(this,e,t,n,r-1,-r)}let i=n-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s|0)-a&255;return t+n},tn.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||tm(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},tn.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||tm(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},tn.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||tm(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},tn.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||tm(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},tn.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||tm(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},tn.prototype.writeBigInt64LE=tO(function(e,t=0){return ty(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),tn.prototype.writeBigInt64BE=tO(function(e,t=0){return tv(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),tn.prototype.writeFloatLE=function(e,t,n){return tb(this,e,t,!0,n)},tn.prototype.writeFloatBE=function(e,t,n){return tb(this,e,t,!1,n)},tn.prototype.writeDoubleLE=function(e,t,n){return tE(this,e,t,!0,n)},tn.prototype.writeDoubleBE=function(e,t,n){return tE(this,e,t,!1,n)},tn.prototype.copy=function(e,t,n,r){if(!tn.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(r<0)throw RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);let i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},tn.prototype.fill=function(e,t,n,r){let i;if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw TypeError("encoding must be a string");if("string"==typeof r&&!tn.isEncoding(r))throw TypeError("Unknown encoding: "+r);if(1===e.length){let t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{let s=tn.isBuffer(e)?e:tn.from(e,r),a=s.length;if(0===a)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=s[i%a]}return this};const t_={};function tT(e,t,n){t_[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function tI(e){let t="",n=e.length,r=+("-"===e[0]);for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function tC(e,t,n,r,i,s){if(e>n||e<t){let r,i="bigint"==typeof t?"n":"";throw r=s>3?0===t||t===BigInt(0)?`>= 0${i} and < 2${i} ** ${(s+1)*8}${i}`:`>= -(2${i} ** ${(s+1)*8-1}${i}) and < 2 ** ${(s+1)*8-1}${i}`:`>= ${t}${i} and <= ${n}${i}`,new t_.ERR_OUT_OF_RANGE("value",r,e)}tS(i,"offset"),(void 0===r[i]||void 0===r[i+s])&&tA(i,r.length-(s+1))}function tS(e,t){if("number"!=typeof e)throw new t_.ERR_INVALID_ARG_TYPE(t,"number",e)}function tA(e,t,n){if(Math.floor(e)!==e)throw tS(e,n),new t_.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new t_.ERR_BUFFER_OUT_OF_BOUNDS;throw new t_.ERR_OUT_OF_RANGE(n||"offset",`>= ${+!!n} and <= ${t}`,e)}tT("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),tT("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),tT("ERR_OUT_OF_RANGE",function(e,t,n){let r=`The value of "${e}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>0x100000000?i=tI(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=tI(i)),i+="n"),r+=` It must be ${t}. Received ${i}`},RangeError);const tx=/[^+/0-9A-Za-z-_]/g;function tD(e,t){let n;t=t||1/0;let r=e.length,i=null,s=[];for(let a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319||a+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function tN(e){return function(e){var t,n,r=function(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}(e),i=r[0],s=r[1],a=new e4((i+s)*3/4-s),o=0,l=s>0?i-4:i;for(n=0;n<l;n+=4)t=e5[e.charCodeAt(n)]<<18|e5[e.charCodeAt(n+1)]<<12|e5[e.charCodeAt(n+2)]<<6|e5[e.charCodeAt(n+3)],a[o++]=t>>16&255,a[o++]=t>>8&255,a[o++]=255&t;return 2===s&&(t=e5[e.charCodeAt(n)]<<2|e5[e.charCodeAt(n+1)]>>4,a[o++]=255&t),1===s&&(t=e5[e.charCodeAt(n)]<<10|e5[e.charCodeAt(n+1)]<<4|e5[e.charCodeAt(n+2)]>>2,a[o++]=t>>8&255,a[o++]=255&t),a}(function(e){if((e=(e=e.split("=")[0]).trim().replace(tx,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function tk(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length)&&!(i>=e.length);++i)t[i+n]=e[i];return i}function tR(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}const tL=function(){let e="0123456789abcdef",t=Array(256);for(let n=0;n<16;++n){let r=16*n;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function tO(e){return"undefined"==typeof BigInt?tM:e}function tM(){throw Error("BigInt not supported")}const tP="@firebase/firestore",tV="4.7.15";class tU{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}tU.UNAUTHENTICATED=new tU(null),tU.GOOGLE_CREDENTIALS=new tU("google-credentials-uid"),tU.FIRST_PARTY=new tU("first-party-uid"),tU.MOCK_USER=new tU("mock-user");let tB="11.8.0";const tF=new eg("@firebase/firestore");function tj(){return tF.logLevel}function t$(e,...t){if(tF.logLevel<=s.DEBUG){let n=t.map(tG);tF.debug(`Firestore (${tB}): ${e}`,...n)}}function tq(e,...t){if(tF.logLevel<=s.ERROR){let n=t.map(tG);tF.error(`Firestore (${tB}): ${e}`,...n)}}function tz(e,...t){if(tF.logLevel<=s.WARN){let n=t.map(tG);tF.warn(`Firestore (${tB}): ${e}`,...n)}}function tG(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function tH(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,tK(e,r,n)}function tK(e,t,n){let r=`FIRESTORE (${tB}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw tq(r),Error(r)}function tQ(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||tK(t,i,r)}const tW={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class tY extends ee{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class tX{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class tJ{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tZ{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(tU.UNAUTHENTICATED))}shutdown(){}}class t0{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class t1{constructor(e){this.t=e,this.currentUser=tU.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){tQ(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new tX;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new tX,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{t$("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(t$("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new tX)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(t$("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(tQ("string"==typeof t.accessToken,31837,{l:t}),new tJ(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return tQ(null===e||"string"==typeof e,2055,{h:e}),new tU(e)}}class t2{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=tU.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class t6{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new t2(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(tU.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class t3{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class t5{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,null!=e&&void 0!==e.settings&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){tQ(void 0===this.o,3512);let n=e=>{null!=e.error&&t$("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,t$("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{t$("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):t$("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new t3(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(tQ("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new t3(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function t4(){return new TextEncoder}class t8{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function t7(e,t){return e<t?-1:+(e>t)}function t9(e,t){let n=0;for(;n<e.length&&n<t.length;){let r=e.codePointAt(n),i=t.codePointAt(n);if(r!==i){if(r<128&&i<128)return t7(r,i);{let s=t4(),a=function(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return t7(e[n],t[n]);return t7(e.length,t.length)}(s.encode(ne(e,n)),s.encode(ne(t,n)));return 0!==a?a:t7(r,i)}}n+=r>65535?2:1}return t7(e.length,t.length)}function ne(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function nt(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class nn{static now(){return nn.fromMillis(Date.now())}static fromDate(e){return nn.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new nn(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new tY(tW.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new tY(tW.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?t7(this.nanoseconds,e.nanoseconds):t7(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class nr{static fromTimestamp(e){return new nr(e)}static min(){return new nr(new nn(0,0))}static max(){return new nr(new nn(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ni="__name__";class ns{constructor(e,t,n){void 0===t?t=0:t>e.length&&tH(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&tH(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ns.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof ns?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=ns.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return t7(e.length,t.length)}static compareSegments(e,t){let n=ns.isNumericId(e),r=ns.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?ns.extractNumericId(e).compare(ns.extractNumericId(t)):t9(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return a.fromString(e.substring(4,e.length-2))}}class na extends ns{construct(e,t,n){return new na(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new tY(tW.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new na(t)}static emptyPath(){return new na([])}}const no=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class nl extends ns{construct(e,t,n){return new nl(e,t,n)}static isValidIdentifier(e){return no.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),nl.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ni}static keyField(){return new nl([ni])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new tY(tW.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new tY(tW.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new tY(tW.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new tY(tW.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new nl(t)}static emptyPath(){return new nl([])}}class nu{constructor(e){this.path=e}static fromPath(e){return new nu(na.fromString(e))}static fromName(e){return new nu(na.fromString(e).popFirst(5))}static empty(){return new nu(na.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===na.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return na.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new nu(new na(e.slice()))}}class nh{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new nh(nr.min(),nu.empty(),-1)}static max(){return new nh(nr.max(),nu.empty(),-1)}}class nc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function nf(e){if(e.code!==tW.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;t$("LocalStore","Unexpectedly lost primary lease")}class nd{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&tH(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new nd((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof nd?t:nd.resolve(t)}catch(e){return nd.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):nd.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):nd.reject(t)}static resolve(e){return new nd((t,n)=>{t(e)})}static reject(e){return new nd((t,n)=>{n(e)})}static waitFor(e){return new nd((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=nd.resolve(!1);for(let n of e)t=t.next(e=>e?nd.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new nd((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new nd((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function np(e){return"IndexedDbTransactionError"===e.name}class ng{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ue(e),this.ce=e=>t.writeSequenceNumber(e))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ce&&this.ce(e),e}}ng.le=-1;function nm(e){return 0===e&&1/e==-1/0}function ny(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function nv(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function nw(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class nb{constructor(e,t){this.comparator=e,this.root=t||n_.EMPTY}insert(e,t){return new nb(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,n_.BLACK,null,null))}remove(e){return new nb(this.comparator,this.root.remove(e,this.comparator).copy(null,null,n_.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nE(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nE(this.root,e,this.comparator,!1)}getReverseIterator(){return new nE(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nE(this.root,e,this.comparator,!0)}}class nE{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class n_{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:n_.RED,this.left=null!=r?r:n_.EMPTY,this.right=null!=i?i:n_.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new n_(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return n_.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return n_.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n_.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n_.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw tH(43730,{key:this.key,value:this.value});if(this.right.isRed())throw tH(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw tH(27949);return e+ +!this.isRed()}}n_.EMPTY=null,n_.RED=!0,n_.BLACK=!1,n_.EMPTY=new class{constructor(){this.size=0}get key(){throw tH(57766)}get value(){throw tH(16141)}get color(){throw tH(16727)}get left(){throw tH(29726)}get right(){throw tH(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new n_(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class nT{constructor(e){this.comparator=e,this.data=new nb(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new nI(this.data.getIterator())}getIteratorFrom(e){return new nI(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof nT)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new nT(this.comparator);return t.data=e,t}}class nI{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class nC{constructor(e){this.fields=e,e.sort(nl.comparator)}static empty(){return new nC([])}unionWith(e){let t=new nT(nl.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new nC(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return nt(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class nS extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class nA{constructor(e){this.binaryString=e}static fromBase64String(e){return new nA(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new nS("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new nA(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return t7(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}nA.EMPTY_BYTE_STRING=new nA("");const nx=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nD(e){if(tQ(!!e,39018),"string"==typeof e){let t=0,n=nx.exec(e);if(tQ(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:nN(e.seconds),nanos:nN(e.nanos)}}function nN(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function nk(e){return"string"==typeof e?nA.fromBase64String(e):nA.fromUint8Array(e)}const nR="server_timestamp",nL="__type__",nO="__previous_value__",nM="__local_write_time__";function nP(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[nL])?void 0:n.stringValue)===nR}function nV(e){let t=e.mapValue.fields[nO];return nP(t)?nV(t):t}function nU(e){let t=nD(e.mapValue.fields[nM].timestampValue);return new nn(t.seconds,t.nanos)}class nB{constructor(e,t,n,r,i,s,a,o,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u}}const nF="(default)";class nj{constructor(e,t){this.projectId=e,this.database=t||nF}static empty(){return new nj("","")}get isDefaultDatabase(){return this.database===nF}isEqual(e){return e instanceof nj&&e.projectId===this.projectId&&e.database===this.database}}const n$="__type__",nq="__max__",nz={mapValue:{fields:{__type__:{stringValue:nq}}}},nG="__vector__",nH="value";function nK(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?nP(e)?4:n7(e)?0x1fffffffffffff:n4(e)?10:11:tH(28295,{value:e})}function nQ(e,t){if(e===t)return!0;let n=nK(e);if(n!==nK(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return nU(e).isEqual(nU(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=nD(e.timestampValue),i=nD(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return nk(e.bytesValue).isEqual(nk(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return nN(e.geoPointValue.latitude)===nN(t.geoPointValue.latitude)&&nN(e.geoPointValue.longitude)===nN(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return nN(e.integerValue)===nN(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=nN(e.doubleValue),r=nN(t.doubleValue);return n===r?nm(n)===nm(r):isNaN(n)&&isNaN(r)}return!1;case 9:return nt(e.arrayValue.values||[],t.arrayValue.values||[],nQ);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(ny(s)!==ny(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!nQ(s[e],a[e])))return!1;return!0;default:return tH(52216,{left:e})}}function nW(e,t){return void 0!==(e.values||[]).find(e=>nQ(e,t))}function nY(e,t){if(e===t)return 0;let n=nK(e),r=nK(t);if(n!==r)return t7(n,r);switch(n){case 0:case 0x1fffffffffffff:return 0;case 1:return t7(e.booleanValue,t.booleanValue);case 2:let i=nN(e.integerValue||e.doubleValue),s=nN(t.integerValue||t.doubleValue);return i<s?-1:i>s?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return nX(e.timestampValue,t.timestampValue);case 4:return nX(nU(e),nU(t));case 5:return t9(e.stringValue,t.stringValue);case 6:return function(e,t){let n=nk(e),r=nk(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=t7(n[e],r[e]);if(0!==t)return t}return t7(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=t7(nN(e.latitude),nN(t.latitude));return 0!==n?n:t7(nN(e.longitude),nN(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return nJ(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;let a=e.fields||{},o=t.fields||{},l=null==(n=a[nH])?void 0:n.arrayValue,u=null==(r=o[nH])?void 0:r.arrayValue,h=t7((null==(i=null==l?void 0:l.values)?void 0:i.length)||0,(null==(s=null==u?void 0:u.values)?void 0:s.length)||0);return 0!==h?h:nJ(l,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===nz.mapValue&&t===nz.mapValue)return 0;if(e===nz.mapValue)return 1;if(t===nz.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=t9(r[e],s[e]);if(0!==t)return t;let a=nY(n[r[e]],i[s[e]]);if(0!==a)return a}return t7(r.length,s.length)}(e.mapValue,t.mapValue);default:throw tH(23264,{Pe:n})}}function nX(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return t7(e,t);let n=nD(e),r=nD(t),i=t7(n.seconds,r.seconds);return 0!==i?i:t7(n.nanos,r.nanos)}function nJ(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=nY(n[e],r[e]);if(t)return t}return t7(n.length,r.length)}function nZ(e){var t,n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=nD(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?nk(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,nu.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=nZ(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${nZ(e.fields[i])}`;return n+"}"}(e.mapValue):tH(61005,{value:e})}function n0(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function n1(e){return!!e&&"integerValue"in e}function n2(e){return!!e&&"arrayValue"in e}function n6(e){return!!e&&"nullValue"in e}function n3(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function n5(e){return!!e&&"mapValue"in e}function n4(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[n$])?void 0:n.stringValue)===nG}function n8(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return nv(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=n8(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=n8(e.arrayValue.values[n]);return t}return Object.assign({},e)}function n7(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===nq}class n9{constructor(e){this.value=e}static empty(){return new n9({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!n5(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=n8(t)}setAll(e){let t=nl.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=n8(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());n5(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return nQ(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];n5(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(nv(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new n9(n8(this.value))}}class re{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new re(e,0,nr.min(),nr.min(),nr.min(),n9.empty(),0)}static newFoundDocument(e,t,n,r){return new re(e,1,t,nr.min(),n,r,0)}static newNoDocument(e,t){return new re(e,2,t,nr.min(),nr.min(),n9.empty(),0)}static newUnknownDocument(e,t){return new re(e,3,t,nr.min(),nr.min(),n9.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(nr.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=n9.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=n9.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=nr.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof re&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new re(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class rt{constructor(e,t){this.position=e,this.inclusive=t}}function rn(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?nu.comparator(nu.fromName(a.referenceValue),n.key):nY(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function rr(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!nQ(e.position[n],t.position[n]))return!1;return!0}class ri{constructor(e,t="asc"){this.field=e,this.dir=t}}class rs{}class ra extends rs{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new rh(e,t,n):"array-contains"===t?new rp(e,n):"in"===t?new rg(e,n):"not-in"===t?new rm(e,n):"array-contains-any"===t?new ry(e,n):new ra(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new rc(e,n):new rf(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(nY(t,this.value)):null!==t&&nK(this.value)===nK(t)&&this.matchesComparison(nY(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return tH(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ro extends rs{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new ro(e,t)}matches(e){return rl(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function rl(e){return"and"===e.op}function ru(e){for(let t of e.filters)if(t instanceof ro)return!1;return!0}class rh extends ra{constructor(e,t,n){super(e,t,n),this.key=nu.fromName(n.referenceValue)}matches(e){let t=nu.comparator(e.key,this.key);return this.matchesComparison(t)}}class rc extends ra{constructor(e,t){super(e,"in",t),this.keys=rd("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class rf extends ra{constructor(e,t){super(e,"not-in",t),this.keys=rd("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function rd(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>nu.fromName(e.referenceValue))}class rp extends ra{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return n2(t)&&nW(t.arrayValue,this.value)}}class rg extends ra{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&nW(this.value.arrayValue,t)}}class rm extends ra{constructor(e,t){super(e,"not-in",t)}matches(e){if(nW(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!nW(this.value.arrayValue,t)}}class ry extends ra{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!n2(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>nW(this.value.arrayValue,e))}}class rv{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.Ie=null}}function rw(e,t=null,n=[],r=[],i=null,s=null,a=null){return new rv(e,t,n,r,i,s,a)}function rb(e){if(null===e.Ie){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof ra)return t.field.canonicalString()+t.op.toString()+nZ(t.value);if(ru(t)&&rl(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>nZ(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>nZ(e)).join(",")),e.Ie=t}return e.Ie}function rE(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof ra?n instanceof ra&&t.op===n.op&&t.field.isEqual(n.field)&&nQ(t.value,n.value):t instanceof ro?n instanceof ro&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void tH(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!rr(e.startAt,t.startAt)&&rr(e.endAt,t.endAt)}function r_(e){return nu.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class rT{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function rI(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function rC(e){return null!==e.collectionGroup}function rS(e){if(null===e.Ee){let t;e.Ee=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ee.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new nT(nl.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ee.push(new ri(t,r))}),n.has(nl.keyField().canonicalString())||e.Ee.push(new ri(nl.keyField(),r))}return e.Ee}function rA(e){return e.de||(e.de=function(e,t){if("F"===e.limitType)return rw(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new ri(e.field,t)});let n=e.endAt?new rt(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new rt(e.startAt.position,e.startAt.inclusive):null;return rw(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(e,rS(e))),e.de}function rx(e,t){let n=e.filters.concat([t]);return new rT(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function rD(e,t,n){return new rT(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function rN(e,t){return rE(rA(e),rA(t))&&e.limitType===t.limitType}function rk(e){return`${rb(rA(e))}|lt:${e.limitType}`}function rR(e){var t;let n;return`Query(target=${n=(t=rA(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof ra?`${t.field.canonicalString()} ${t.op} ${nZ(t.value)}`:t instanceof ro?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>nZ(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>nZ(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function rL(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):nu.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of rS(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,n){let r=rn(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,rS(e),t))&&(!e.endAt||!!function(e,t,n){let r=rn(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,rS(e),t))}function rO(e){return(t,n)=>{let r=!1;for(let i of rS(e)){let e=function(e,t,n){let r=e.field.isKeyField()?nu.comparator(t.key,n.key):function(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?nY(r,i):tH(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return tH(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class rM{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){nv(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return nw(this.inner)}size(){return this.innerSize}}const rP=new nb(nu.comparator),rV=new nb(nu.comparator);function rU(...e){let t=rV;for(let n of e)t=t.insert(n.key,n);return t}function rB(e){let t=rV;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function rF(){return new rM(e=>e.toString(),(e,t)=>e.isEqual(t))}const rj=new nb(nu.comparator),r$=new nT(nu.comparator);function rq(...e){let t=r$;for(let n of e)t=t.add(n);return t}const rz=new nT(t7);function rG(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:nm(t)?"-0":t}}function rH(e){return{integerValue:""+e}}class rK{constructor(){this._=void 0}}function rQ(e,t){return e instanceof r0?n1(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class rW extends rK{}class rY extends rK{constructor(e){super(),this.elements=e}}function rX(e,t){let n=r2(t);for(let t of e.elements)n.some(e=>nQ(e,t))||n.push(t);return{arrayValue:{values:n}}}class rJ extends rK{constructor(e){super(),this.elements=e}}function rZ(e,t){let n=r2(t);for(let t of e.elements)n=n.filter(e=>!nQ(e,t));return{arrayValue:{values:n}}}class r0 extends rK{constructor(e,t){super(),this.serializer=e,this.Re=t}}function r1(e){return nN(e.integerValue||e.doubleValue)}function r2(e){return n2(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class r6{constructor(e,t){this.field=e,this.transform=t}}class r3{constructor(e,t){this.version=e,this.transformResults=t}}class r5{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new r5}static exists(e){return new r5(void 0,e)}static updateTime(e){return new r5(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function r4(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class r8{}function r7(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new io(e.key,r5.none()):new it(e.key,e.data,r5.none());{let n=e.data,r=n9.empty(),i=new nT(nl.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new ir(e.key,r,new nC(i.toArray()),r5.none())}}function r9(e,t,n,r){return e instanceof it?function(e,t,n,r){if(!r4(e.precondition,t))return n;let i=e.value.clone(),s=ia(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof ir?function(e,t,n,r){if(!r4(e.precondition,t))return n;let i=ia(e.fieldTransforms,r,t),s=t.data;return(s.setAll(ii(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):r4(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function ie(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&nt(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof rY&&r instanceof rY||n instanceof rJ&&r instanceof rJ?nt(n.elements,r.elements,nQ):n instanceof r0&&r instanceof r0?nQ(n.Re,r.Re):n instanceof rW&&r instanceof rW)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class it extends r8{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ir extends r8{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ii(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function is(e,t,n){let r=new Map;tQ(e.length===n.length,32656,{Ve:n.length,me:e.length});for(let s=0;s<n.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);r.set(a.field,(i=n[s],o instanceof rY?rX(o,l):o instanceof rJ?rZ(o,l):i))}return r}function ia(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,e instanceof rW?function(e,t){let n={fields:{[nL]:{stringValue:nR},[nM]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&nP(t)&&(t=nV(t)),t&&(n.fields[nO]=t),{mapValue:n}}(t,s):e instanceof rY?rX(e,s):e instanceof rJ?rZ(e,s):function(e,t){let n=rQ(e,t),r=r1(n)+r1(e.Re);return n1(n)&&n1(e.Re)?rH(r):rG(e.serializer,r)}(e,s))}return r}class io extends r8{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class il extends r8{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class iu{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){e instanceof it?function(e,t,n){let r=e.value.clone(),i=is(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof ir?function(e,t,n){if(!r4(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=is(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(ii(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=r9(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=r9(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=rF();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=r7(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(nr.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),rq())}isEqual(e){return this.batchId===e.batchId&&nt(this.mutations,e.mutations,(e,t)=>ie(e,t))&&nt(this.baseMutations,e.baseMutations,(e,t)=>ie(e,t))}}class ih{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){tQ(e.mutations.length===n.length,58842,{fe:e.mutations.length,ge:n.length});let r=rj,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new ih(e,t,n,r)}}class ic{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class id{constructor(e,t){this.count=e,this.unchangedNames=t}}function ip(e){if(void 0===e)return tq("GRPC error has no .code"),tW.UNKNOWN;switch(e){case w.OK:return tW.OK;case w.CANCELLED:return tW.CANCELLED;case w.UNKNOWN:return tW.UNKNOWN;case w.DEADLINE_EXCEEDED:return tW.DEADLINE_EXCEEDED;case w.RESOURCE_EXHAUSTED:return tW.RESOURCE_EXHAUSTED;case w.INTERNAL:return tW.INTERNAL;case w.UNAVAILABLE:return tW.UNAVAILABLE;case w.UNAUTHENTICATED:return tW.UNAUTHENTICATED;case w.INVALID_ARGUMENT:return tW.INVALID_ARGUMENT;case w.NOT_FOUND:return tW.NOT_FOUND;case w.ALREADY_EXISTS:return tW.ALREADY_EXISTS;case w.PERMISSION_DENIED:return tW.PERMISSION_DENIED;case w.FAILED_PRECONDITION:return tW.FAILED_PRECONDITION;case w.ABORTED:return tW.ABORTED;case w.OUT_OF_RANGE:return tW.OUT_OF_RANGE;case w.UNIMPLEMENTED:return tW.UNIMPLEMENTED;case w.DATA_LOSS:return tW.DATA_LOSS;default:return tH(39323,{code:e})}}(b=w||(w={}))[b.OK=0]="OK",b[b.CANCELLED=1]="CANCELLED",b[b.UNKNOWN=2]="UNKNOWN",b[b.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",b[b.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",b[b.NOT_FOUND=5]="NOT_FOUND",b[b.ALREADY_EXISTS=6]="ALREADY_EXISTS",b[b.PERMISSION_DENIED=7]="PERMISSION_DENIED",b[b.UNAUTHENTICATED=16]="UNAUTHENTICATED",b[b.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",b[b.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",b[b.ABORTED=10]="ABORTED",b[b.OUT_OF_RANGE=11]="OUT_OF_RANGE",b[b.UNIMPLEMENTED=12]="UNIMPLEMENTED",b[b.INTERNAL=13]="INTERNAL",b[b.UNAVAILABLE=14]="UNAVAILABLE",b[b.DATA_LOSS=15]="DATA_LOSS";const ig=new a([0xffffffff,0xffffffff],0);function im(e){let t=t4().encode(e),n=new o;return n.update(t),new Uint8Array(n.digest())}function iy(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new a([n,r],0),new a([i,s],0)]}class iv{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new iw(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new iw(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new iw(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=a.fromNumber(this.pe)}we(e,t,n){let r=e.add(t.multiply(a.fromNumber(n)));return 1===r.compare(ig)&&(r=new a([r.getBits(0),r.getBits(1)],0)),r.modulo(this.ye).toNumber()}Se(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.pe)return!1;let[t,n]=iy(im(e));for(let e=0;e<this.hashCount;e++){let r=this.we(t,n,e);if(!this.Se(r))return!1}return!0}static create(e,t,n){let r=new iv(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.pe)return;let[t,n]=iy(im(e));for(let e=0;e<this.hashCount;e++){let r=this.we(t,n,e);this.be(r)}}be(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class iw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ib{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,iE.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ib(nr.min(),r,new nb(t7),rP,rq())}}class iE{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new iE(n,t,rq(),rq(),rq())}}class i_{constructor(e,t,n,r){this.De=e,this.removedTargetIds=t,this.key=n,this.ve=r}}class iT{constructor(e,t){this.targetId=e,this.Ce=t}}class iI{constructor(e,t,n=nA.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class iC{constructor(){this.Fe=0,this.Me=ix(),this.xe=nA.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=rq(),t=rq(),n=rq();return this.Me.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:tH(38017,{changeType:i})}}),new iE(this.xe,this.Oe,e,t,n)}Qe(){this.Ne=!1,this.Me=ix()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,tQ(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class iS{constructor(e){this.ze=e,this.je=new Map,this.He=rP,this.Je=iA(),this.Ye=iA(),this.Ze=new nb(t7)}Xe(e){for(let t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(let t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{let n=this.rt(t);switch(e.state){case 0:this.it(t)&&n.ke(e.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(e.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(t);break;case 3:this.it(t)&&(n.Ge(),n.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),n.ke(e.resumeToken));break;default:tH(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((e,n)=>{this.it(n)&&t(n)})}ot(e){let t=e.targetId,n=e.Ce.count,r=this._t(t);if(r){let i=r.target;if(r_(i))if(0===n){let e=new nu(i.path);this.tt(t,e,re.newNoDocument(e,nr.min()))}else tQ(1===n,20013,{expectedCount:n});else{let r=this.ut(t);if(r!==n){let n=this.ct(e),i=n?this.lt(n,e,r):1;0!==i&&(this.st(t),this.Ze=this.Ze.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}ct(e){let t,n,r=e.Ce.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=nk(i).toUint8Array()}catch(e){if(e instanceof nS)return tz("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new iv(t,s,a)}catch(e){return tz(e instanceof iw?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.pe?null:n}lt(e,t,n){return 2*(t.Ce.count!==n-this.Tt(e,t.targetId))}Tt(e,t){let n=this.ze.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.ze.Pt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.tt(t,n,null),r++)}),r}It(e){let t=new Map;this.je.forEach((n,r)=>{let i=this._t(r);if(i){if(n.current&&r_(i.target)){let t=new nu(i.target.path);this.Et(t).has(r)||this.dt(r,t)||this.tt(r,t,re.newNoDocument(t,e))}n.Le&&(t.set(r,n.qe()),n.Qe())}});let n=rq();this.Ye.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this._t(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.He.forEach((t,n)=>n.setReadTime(e));let r=new ib(e,t,this.Ze,this.He,n);return this.He=rP,this.Je=iA(),this.Ye=iA(),this.Ze=new nb(t7),r}et(e,t){if(!this.it(e))return;let n=2*!!this.dt(e,t.key);this.rt(e).$e(t.key,n),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,n){if(!this.it(e))return;let r=this.rt(e);this.dt(e,t)?r.$e(t,1):r.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),n&&(this.He=this.He.insert(t,n))}removeTarget(e){this.je.delete(e)}ut(e){let t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new iC,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new nT(t7),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new nT(t7),this.Je=this.Je.insert(e,t)),t}it(e){let t=null!==this._t(e);return t||t$("WatchChangeAggregator","Detected inactive target",e),t}_t(e){let t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new iC),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function iA(){return new nb(nu.comparator)}function ix(){return new nb(nu.comparator)}const iD={asc:"ASCENDING",desc:"DESCENDING"},iN={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ik={and:"AND",or:"OR"};class iR{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function iL(e,t){return e.useProto3Json||null==t?t:{value:t}}function iO(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function iM(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function iP(e){return tQ(!!e,49232),nr.fromTimestamp(function(e){let t=nD(e);return new nn(t.seconds,t.nanos)}(e))}function iV(e,t){return iU(e,t).canonicalString()}function iU(e,t){let n=new na(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function iB(e){let t=na.fromString(e);return tQ(iQ(t),10190,{key:t.toString()}),t}function iF(e,t){return iV(e.databaseId,t.path)}function ij(e,t){let n=iB(t);if(n.get(1)!==e.databaseId.projectId)throw new tY(tW.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new tY(tW.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new nu(iz(n))}function i$(e,t){return iV(e.databaseId,t)}function iq(e){return new na(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function iz(e){return tQ(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function iG(e,t,n){return{name:iF(e,t),fields:n.value.mapValue.fields}}function iH(e){return{fieldPath:e.canonicalString()}}function iK(e){return nl.fromServerFormat(e.fieldPath)}function iQ(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class iW{constructor(e,t,n,r,i=nr.min(),s=nr.min(),a=nA.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new iW(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new iW(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new iW(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new iW(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class iY{constructor(e){this.wt=e}}class iX{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(+!!e.booleanValue);else if("integerValue"in e)this.Mt(t,15),t.xt(nN(e.integerValue));else if("doubleValue"in e){let n=nN(e.doubleValue);isNaN(n)?this.Mt(t,13):(this.Mt(t,15),nm(n)?t.xt(0):t.xt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Mt(t,20),"string"==typeof n&&(n=nD(n)),t.Ot(`${n.seconds||""}`),t.xt(n.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(nk(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Mt(t,45),t.xt(n.latitude||0),t.xt(n.longitude||0)}else"mapValue"in e?n7(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):n4(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):tH(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){let n=e.fields||{};for(let e of(this.Mt(t,55),Object.keys(n)))this.Nt(e,t),this.Ct(n[e],t)}qt(e,t){var n,r;let i=e.fields||{};this.Mt(t,53);let s=(null==(r=null==(n=i[nH].arrayValue)?void 0:n.values)?void 0:r.length)||0;this.Mt(t,15),t.xt(nN(s)),this.Nt(nH,t),this.Ct(i[nH],t)}$t(e,t){let n=e.values||[];for(let e of(this.Mt(t,50),n))this.Ct(e,t)}kt(e,t){this.Mt(t,37),nu.fromName(e).path.forEach(e=>{this.Mt(t,60),this.Kt(e,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}}iX.Wt=new iX;class iJ{constructor(){this.Cn=new iZ}addToCollectionParentIndex(e,t){return this.Cn.add(t),nd.resolve()}getCollectionParents(e,t){return nd.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return nd.resolve()}deleteFieldIndex(e,t){return nd.resolve()}deleteAllFieldIndexes(e){return nd.resolve()}createTargetIndexes(e,t){return nd.resolve()}getDocumentsMatchingTarget(e,t){return nd.resolve(null)}getIndexType(e,t){return nd.resolve(0)}getFieldIndexes(e,t){return nd.resolve([])}getNextCollectionGroupToUpdate(e){return nd.resolve(null)}getMinOffset(e,t){return nd.resolve(nh.min())}getMinOffsetFromCollectionGroup(e,t){return nd.resolve(nh.min())}updateCollectionGroup(e,t,n){return nd.resolve()}updateIndexEntries(e,t){return nd.resolve()}}class iZ{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new nT(na.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new nT(na.comparator)).toArray()}}new Uint8Array(0);const i0={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class i1{static withCacheSize(e){return new i1(e,i1.DEFAULT_COLLECTION_PERCENTILE,i1.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}i1.DEFAULT_COLLECTION_PERCENTILE=10,i1.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,i1.DEFAULT=new i1(0x2800000,i1.DEFAULT_COLLECTION_PERCENTILE,i1.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),i1.DISABLED=new i1(-1,0,0);class i2{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new i2(0)}static lr(){return new i2(-1)}}const i6="LruGarbageCollector";function i3([e,t],[n,r]){let i=t7(e,n);return 0===i?t7(t,r):i}class i5{constructor(e){this.Er=e,this.buffer=new nT(i3),this.dr=0}Ar(){return++this.dr}Rr(e){let t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>i3(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class i4{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Vr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return null!==this.Vr}mr(e){t$(i6,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){np(e)?t$(i6,"Ignoring IndexedDB error during garbage collection: ",e):await nf(e)}await this.mr(3e5)})}}class i8{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return nd.resolve(ng.le);let n=new i5(t);return this.gr.forEachTarget(e,e=>n.Rr(e.sequenceNumber)).next(()=>this.gr.yr(e,e=>n.Rr(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.gr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(t$("LruGarbageCollector","Garbage collection skipped; disabled"),nd.resolve(i0)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(t$("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),i0):this.wr(e,t))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let n,r,i,a,o,l,u,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(t$("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,a=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,l=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(u=Date.now(),tj()<=s.DEBUG&&t$("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${r} in `+(o-a)+"ms\n"+`	Removed ${i} targets in `+(l-o)+"ms\n"+`	Removed ${e} documents in `+(u-l)+"ms\n"+`Total Duration: ${u-h}ms`),nd.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class i7{constructor(){this.changes=new rM(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,re.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?nd.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class i9{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class se{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&r9(n.mutation,e,nC.empty(),nn.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,rq()).next(()=>t))}getLocalViewOfDocuments(e,t,n=rq()){let r=rF();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=rU();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=rF();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,rq()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=rP,s=rF(),a=rF();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof ir)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),r9(a.mutation,t,a.mutation.getFieldMask(),nn.now())):s.set(t.key,nC.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new i9(t,null!=(n=s.get(e))?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=rF(),r=new nb((e,t)=>e-t),i=rq();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||nC.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||rq()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=rF();l.forEach(e=>{if(!i.has(e)){let r=r7(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return nd.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return nu.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):rC(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):nd.resolve(rF()),a=-1,o=i;return s.next(t=>nd.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?nd.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,rq())).next(e=>({batchId:a,changes:rB(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new nu(t)).next(e=>{let t=rU();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=rU();return this.indexManager.getCollectionParents(e,i).next(a=>nd.forEach(a,a=>{let o=new rT(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,re.newInvalidDocument(r)))});let n=rU();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&r9(s.mutation,r,nC.empty(),nn.now()),rL(t,r)&&(n=n.insert(e,r))}),n})}}class st{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return nd.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,{id:t.id,version:t.version,createTime:iP(t.createTime)}),nd.resolve()}getNamedQuery(e,t){return nd.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,{name:t.name,query:function(e){let t=function(e){var t;let n,r=function(e){let t=iB(e);return 4===t.length?na.emptyPath():iz(t)}(e.parent),i=e.structuredQuery,s=i.from?i.from.length:0,a=null;if(s>0){tQ(1===s,65062);let e=i.from[0];e.allDescendants?a=e.collectionId:r=r.child(e.collectionId)}let o=[];i.where&&(o=function(e){var t;let n=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=iK(e.unaryFilter.field);return ra.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=iK(e.unaryFilter.field);return ra.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=iK(e.unaryFilter.field);return ra.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=iK(e.unaryFilter.field);return ra.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return tH(61313);default:return tH(60726)}}(t):void 0!==t.fieldFilter?ra.create(iK(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return tH(58110);default:return tH(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?ro.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return tH(1026)}}(t.compositeFilter.op)):tH(30097,{filter:t})}(e);return n instanceof ro&&ru(t=n)&&rl(t)?n.getFilters():[n]}(i.where));let l=[];i.orderBy&&(l=i.orderBy.map(e=>new ri(iK(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let u=null;i.limit&&(u=null==(n="object"==typeof(t=i.limit)?t.value:t)?null:n);let h=null;i.startAt&&(h=function(e){let t=!!e.before;return new rt(e.values||[],t)}(i.startAt));let c=null;return i.endAt&&(c=function(e){let t=!e.before;return new rt(e.values||[],t)}(i.endAt)),new rT(r,a,l,o,u,"F",h,c)}({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?rD(t,t.limit,"L"):t}(t.bundledQuery),readTime:iP(t.readTime)}),nd.resolve()}}class sn{constructor(){this.overlays=new nb(nu.comparator),this.Qr=new Map}getOverlay(e,t){return nd.resolve(this.overlays.get(t))}getOverlays(e,t){let n=rF();return nd.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.bt(e,t,r)}),nd.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.Qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Qr.delete(n)),nd.resolve()}getOverlaysForCollection(e,t,n){let r=rF(),i=t.length+1,s=new nu(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return nd.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new nb((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=rF(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=rF(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return nd.resolve(a)}bt(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.Qr.get(r.largestBatchId).delete(n.key);this.Qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new ic(t,n));let i=this.Qr.get(t);void 0===i&&(i=rq(),this.Qr.set(t,i)),this.Qr.set(t,i.add(n.key))}}class sr{constructor(){this.sessionToken=nA.EMPTY_BYTE_STRING}getSessionToken(e){return nd.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,nd.resolve()}}class si{constructor(){this.$r=new nT(ss.Ur),this.Kr=new nT(ss.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){let n=new ss(e,t);this.$r=this.$r.add(n),this.Kr=this.Kr.add(n)}Gr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.zr(new ss(e,t))}jr(e,t){e.forEach(e=>this.removeReference(e,t))}Hr(e){let t=new nu(new na([])),n=new ss(t,e),r=new ss(t,e+1),i=[];return this.Kr.forEachInRange([n,r],e=>{this.zr(e),i.push(e.key)}),i}Jr(){this.$r.forEach(e=>this.zr(e))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){let t=new nu(new na([])),n=new ss(t,e),r=new ss(t,e+1),i=rq();return this.Kr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new ss(e,0),n=this.$r.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ss{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return nu.comparator(e.key,t.key)||t7(e.Zr,t.Zr)}static Wr(e,t){return t7(e.Zr,t.Zr)||nu.comparator(e.key,t.key)}}class sa{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new nT(ss.Ur)}checkEmpty(e){return nd.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new iu(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Xr=this.Xr.add(new ss(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return nd.resolve(s)}lookupMutationBatch(e,t){return nd.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.ti(t+1),r=n<0?0:n;return nd.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return nd.resolve(0===this.mutationQueue.length?-1:this.nr-1)}getAllMutationBatches(e){return nd.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new ss(t,0),r=new ss(t,Number.POSITIVE_INFINITY),i=[];return this.Xr.forEachInRange([n,r],e=>{let t=this.ei(e.Zr);i.push(t)}),nd.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new nT(t7);return t.forEach(e=>{let t=new ss(e,0),r=new ss(e,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([t,r],e=>{n=n.add(e.Zr)})}),nd.resolve(this.ni(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;nu.isDocumentKey(i)||(i=i.child(""));let s=new ss(new nu(i),0),a=new nT(t7);return this.Xr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Zr)),!0)},s),nd.resolve(this.ni(a))}ni(e){let t=[];return e.forEach(e=>{let n=this.ei(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){tQ(0===this.ri(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Xr;return nd.forEach(t.mutations,r=>{let i=new ss(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Xr=n})}sr(e){}containsKey(e,t){let n=new ss(t,0),r=this.Xr.firstAfterOrEqual(n);return nd.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,nd.resolve()}ri(e,t){return this.ti(e)}ti(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ei(e){let t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class so{constructor(e){this.ii=e,this.docs=new nb(nu.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ii(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return nd.resolve(n?n.document.mutableCopy():re.newInvalidDocument(t))}getEntries(e,t){let n=rP;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():re.newInvalidDocument(e))}),nd.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=rP,s=t.path,a=new nu(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=function(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=nu.comparator(e.documentKey,t.documentKey))?n:t7(e.largestBatchId,t.largestBatchId)}(new nh(a.readTime,a.key,-1),n)||(r.has(a.key)||rL(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return nd.resolve(i)}getAllFromCollectionGroup(e,t,n,r){tH(9500)}si(e,t){return nd.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new sl(this)}getSize(e){return nd.resolve(this.size)}}class sl extends i7{constructor(e){super(),this.Br=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Br.addEntry(e,r)):this.Br.removeEntry(n)}),nd.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}}class su{constructor(e){this.persistence=e,this.oi=new rM(e=>rb(e),rE),this.lastRemoteSnapshotVersion=nr.min(),this.highestTargetId=0,this._i=0,this.ai=new si,this.targetCount=0,this.ui=i2.cr()}forEachTarget(e,t){return this.oi.forEach((e,n)=>t(n)),nd.resolve()}getLastRemoteSnapshotVersion(e){return nd.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return nd.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),nd.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this._i&&(this._i=t),nd.resolve()}Tr(e){this.oi.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ui=new i2(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,nd.resolve()}updateTargetData(e,t){return this.Tr(t),nd.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,nd.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.oi.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.oi.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),nd.waitFor(i).next(()=>r)}getTargetCount(e){return nd.resolve(this.targetCount)}getTargetData(e,t){let n=this.oi.get(t)||null;return nd.resolve(n)}addMatchingKeys(e,t,n){return this.ai.Gr(t,n),nd.resolve()}removeMatchingKeys(e,t,n){this.ai.jr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),nd.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),nd.resolve()}getMatchingKeysForTargetId(e,t){let n=this.ai.Yr(t);return nd.resolve(n)}containsKey(e,t){return nd.resolve(this.ai.containsKey(t))}}class sh{constructor(e,t){this.ci={},this.overlays={},this.li=new ng(0),this.hi=!1,this.hi=!0,this.Pi=new sr,this.referenceDelegate=e(this),this.Ti=new su(this),this.indexManager=new iJ,this.remoteDocumentCache=new so(e=>this.referenceDelegate.Ii(e)),this.serializer=new iY(t),this.Ei=new st(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sn,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ci[e.toKey()];return n||(n=new sa(t,this.referenceDelegate),this.ci[e.toKey()]=n),n}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,n){t$("MemoryPersistence","Starting transaction:",e);let r=new sc(this.li.next());return this.referenceDelegate.di(),n(r).next(e=>this.referenceDelegate.Ai(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ri(e,t){return nd.or(Object.values(this.ci).map(n=>()=>n.containsKey(e,t)))}}class sc extends nc{constructor(e){super(),this.currentSequenceNumber=e}}class sf{constructor(e){this.persistence=e,this.Vi=new si,this.mi=null}static fi(e){return new sf(e)}get gi(){if(this.mi)return this.mi;throw tH(60996)}addReference(e,t,n){return this.Vi.addReference(n,t),this.gi.delete(n.toString()),nd.resolve()}removeReference(e,t,n){return this.Vi.removeReference(n,t),this.gi.add(n.toString()),nd.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),nd.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach(e=>this.gi.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.gi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}di(){this.mi=new Set}Ai(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nd.forEach(this.gi,n=>{let r=nu.fromPath(n);return this.pi(e,r).next(e=>{e||t.removeEntry(r,nr.min())})}).next(()=>(this.mi=null,t.apply(e)))}updateLimboDocument(e,t){return this.pi(e,t).next(e=>{e?this.gi.delete(t.toString()):this.gi.add(t.toString())})}Ii(e){return 0}pi(e,t){return nd.or([()=>nd.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}}class sd{constructor(e,t){this.persistence=e,this.yi=new rM(e=>(function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"})(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new i8(this,t)}static fi(e,t){return new sd(e,t)}di(){}Ai(e){return nd.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}pr(e){let t=this.Sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Sr(e){let t=0;return this.yr(e,e=>{t++}).next(()=>t)}yr(e,t){return nd.forEach(this.yi,(n,r)=>this.Dr(e,n,r).next(e=>e?nd.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.si(e,r=>this.Dr(e,r,t).next(e=>{e||(n++,i.removeEntry(r,nr.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.yi.set(t,e.currentSequenceNumber),nd.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.yi.set(n,e.currentSequenceNumber),nd.resolve()}removeReference(e,t,n){return this.yi.set(n,e.currentSequenceNumber),nd.resolve()}updateLimboDocument(e,t){return this.yi.set(t,e.currentSequenceNumber),nd.resolve()}Ii(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(nK(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=nV(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return nk(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,nv(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw tH(13486,{value:t})}}(e.data.value)),t}Dr(e,t,n){return nd.or([()=>this.persistence.Ri(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.yi.get(t);return nd.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class sp{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.ds=n,this.As=r}static Rs(e,t){let n=rq(),r=rq();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new sp(e,t.fromCache,n,r)}}class sg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class sm{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=!function(){var e;let t=null==(e=z())?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(T.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ws(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.Ss(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new sg;return this.bs(e,t,n).next(r=>{if(i.result=r,this.fs)return this.Ds(e,t,n,r.size)})}).next(()=>i.result)}Ds(e,t,n,r){return n.documentReadCount<this.gs?(tj()<=s.DEBUG&&t$("QueryEngine","SDK will not create cache indexes for query:",rR(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),nd.resolve()):(tj()<=s.DEBUG&&t$("QueryEngine","Query:",rR(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ps*r?(tj()<=s.DEBUG&&t$("QueryEngine","The SDK decides to create cache indexes for query:",rR(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,rA(t))):nd.resolve())}ws(e,t){if(rI(t))return nd.resolve(null);let n=rA(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=rA(t=rD(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=rq(...r);return this.ys.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.vs(t,r);return this.Cs(t,s,i,n.readTime)?this.ws(e,rD(t,null,"F")):this.Fs(e,s,t,n)}))})))}Ss(e,t,n,r){return rI(t)||r.isEqual(nr.min())?nd.resolve(null):this.ys.getDocuments(e,n).next(i=>{let a=this.vs(t,i);return this.Cs(t,a,n,r)?nd.resolve(null):(tj()<=s.DEBUG&&t$("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),rR(t)),this.Fs(e,a,t,function(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new nh(nr.fromTimestamp(1e9===r?new nn(n+1,0):new nn(n,r)),nu.empty(),-1)}(r,0)).next(e=>e))})}vs(e,t){let n=new nT(rO(e));return t.forEach((t,r)=>{rL(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}bs(e,t,n){return tj()<=s.DEBUG&&t$("QueryEngine","Using full collection scan to execute query:",rR(t)),this.ys.getDocumentsMatchingQuery(e,t,nh.min(),n)}Fs(e,t,n,r){return this.ys.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const sy="LocalStore";class sv{constructor(e,t,n,r){this.persistence=e,this.Ms=t,this.serializer=r,this.xs=new nb(t7),this.Os=new rM(e=>rb(e),rE),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(n)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new se(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.xs))}}async function sw(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Ls(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=rq();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({ks:e,removedBatchIds:i,addedBatchIds:s}))})})}function sb(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ti.getLastRemoteSnapshotVersion(t))}async function sE(e,t,n){let r=e.xs.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!np(e))throw e;t$(sy,`Failed to update sequence numbers for target ${t}: ${e}`)}e.xs=e.xs.remove(t),e.Os.delete(r.target)}function s_(e,t,n){let r=nr.min(),i=rq();return e.persistence.runTransaction("Execute query","readwrite",s=>(function(e,t,n){let r=e.Os.get(n);return void 0!==r?nd.resolve(e.xs.get(r)):e.Ti.getTargetData(t,n)})(e,s,rA(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Ti.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Ms.getDocumentsMatchingQuery(s,t,n?r:nr.min(),n?i:rq())).next(n=>{var r,s,a;let o;return r=e,s=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),a=n,o=r.Ns.get(s)||nr.min(),a.forEach((e,t)=>{t.readTime.compareTo(o)>0&&(o=t.readTime)}),r.Ns.set(s,o),{documents:n,$s:i}}))}class sT{constructor(){this.activeTargetIds=rz}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class sI{constructor(){this.xo=new sT,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,n){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new sT,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class sC{No(e){}shutdown(){}}const sS="ConnectivityMonitor";class sA{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){for(let e of(t$(sS,"Network connectivity changed: AVAILABLE"),this.Qo))e(0)}qo(){for(let e of(t$(sS,"Network connectivity changed: UNAVAILABLE"),this.Qo))e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let sx=null;function sD(){return null===sx?sx=0x10000000+Math.round(0x80000000*Math.random()):sx++,"0x"+sx.toString(16)}const sN="RestConnection",sk={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class sR{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${n}/databases/${r}`,this.Go=this.databaseId.database===nF?`project_id=${n}`:`project_id=${n}&database_id=${r}`}zo(e,t,n,r,i){let s=sD(),a=this.jo(e,t.toUriEncodedString());t$(sN,`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(o,r,i);let{host:l}=new URL(a),u=W(l);return this.Jo(e,a,o,n,u).then(t=>(t$(sN,`Received RPC '${e}' ${s}: `,t),t),t=>{throw tz(sN,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}Yo(e,t,n,r,i,s){return this.zo(e,t,n,r,i)}Ho(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+tB,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}jo(e,t){let n=sk[e];return`${this.Ko}/v1/${t}:${n}`}terminate(){}}class sL{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}const sO="WebChannelConnection";class sM extends sR{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,i){let s=sD();return new Promise((i,a)=>{let o=new l;o.setWithCredentials(!0),o.listenOnce(h.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case c.NO_ERROR:let t=o.getResponseJson();t$(sO,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case c.TIMEOUT:t$(sO,`RPC '${e}' ${s} timed out`),a(new tY(tW.DEADLINE_EXCEEDED,"Request time out"));break;case c.HTTP_ERROR:let n=o.getStatus();if(t$(sO,`RPC '${e}' ${s} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(tW).indexOf(t)>=0?t:tW.UNKNOWN}(t.status);a(new tY(e,t.message))}else a(new tY(tW.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new tY(tW.UNAVAILABLE,"Connection failed."));break;default:tH(9055,{l_:e,streamId:s,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{t$(sO,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(r);t$(sO,`RPC '${e}' ${s} sending request:`,r),o.send(t,"POST",u,n,15)})}T_(e,t,n){let r=sD(),i=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=g(),a=p(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Ho(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;let h=i.join("");t$(sO,`Creating RPC '${e}' stream ${r}: ${h}`,o);let c=s.createWebChannel(h,o),m=!1,y=!1,v=new sL({Zo:t=>{y?t$(sO,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(m||(t$(sO,`Opening RPC '${e}' stream ${r} transport.`),c.open(),m=!0),t$(sO,`RPC '${e}' stream ${r} sending:`,t),c.send(t))},Xo:()=>c.close()}),b=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return b(c,u.EventType.OPEN,()=>{y||(t$(sO,`RPC '${e}' stream ${r} transport opened.`),v.__())}),b(c,u.EventType.CLOSE,()=>{y||(y=!0,t$(sO,`RPC '${e}' stream ${r} transport closed`),v.u_())}),b(c,u.EventType.ERROR,t=>{y||(y=!0,tz(sO,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),v.u_(new tY(tW.UNAVAILABLE,"The operation could not be completed")))}),b(c,u.EventType.MESSAGE,t=>{var n;if(!y){let i=t.data[0];tQ(!!i,16349);let s=(null==i?void 0:i.error)||(null==(n=i[0])?void 0:n.error);if(s){t$(sO,`RPC '${e}' stream ${r} received error:`,s);let t=s.status,n=function(e){let t=w[e];if(void 0!==t)return ip(t)}(t),i=s.message;void 0===n&&(n=tW.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),y=!0,v.u_(new tY(n,i)),c.close()}else t$(sO,`RPC '${e}' stream ${r} received:`,i),v.c_(i)}}),b(a,d.STAT_EVENT,t=>{t.stat===f.PROXY?t$(sO,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===f.NOPROXY&&t$(sO,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{v.a_()},0),v}}function sP(){return"undefined"!=typeof document?document:null}function sV(e){return new iR(e,!0)}class sU{constructor(e,t,n=1e3,r=1.5,i=6e4){this.xi=e,this.timerId=t,this.I_=n,this.E_=r,this.d_=i,this.A_=0,this.R_=null,this.V_=Date.now(),this.reset()}reset(){this.A_=0}m_(){this.A_=this.d_}f_(e){this.cancel();let t=Math.floor(this.A_+this.g_()),n=Math.max(0,Date.now()-this.V_),r=Math.max(0,t-n);r>0&&t$("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.A_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.R_=this.xi.enqueueAfterDelay(this.timerId,r,()=>(this.V_=Date.now(),e())),this.A_*=this.E_,this.A_<this.I_&&(this.A_=this.I_),this.A_>this.d_&&(this.A_=this.d_)}p_(){null!==this.R_&&(this.R_.skipDelay(),this.R_=null)}cancel(){null!==this.R_&&(this.R_.cancel(),this.R_=null)}g_(){return(Math.random()-.5)*this.A_}}const sB="PersistentStream";class sF{constructor(e,t,n,r,i,s,a,o){this.xi=e,this.y_=n,this.w_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.S_=0,this.b_=null,this.D_=null,this.stream=null,this.v_=0,this.C_=new sU(e,t)}F_(){return 1===this.state||5===this.state||this.M_()}M_(){return 2===this.state||3===this.state}start(){this.v_=0,4!==this.state?this.auth():this.x_()}async stop(){this.F_()&&await this.close(0)}O_(){this.state=0,this.C_.reset()}N_(){this.M_()&&null===this.b_&&(this.b_=this.xi.enqueueAfterDelay(this.y_,6e4,()=>this.B_()))}L_(e){this.k_(),this.stream.send(e)}async B_(){if(this.M_())return this.close(0)}k_(){this.b_&&(this.b_.cancel(),this.b_=null)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}async close(e,t){this.k_(),this.q_(),this.C_.cancel(),this.S_++,4!==e?this.C_.reset():t&&t.code===tW.RESOURCE_EXHAUSTED?(tq(t.toString()),tq("Using maximum backoff delay to prevent overloading the backend."),this.C_.m_()):t&&t.code===tW.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Q_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.i_(t)}Q_(){}auth(){this.state=1;let e=this.U_(this.S_),t=this.S_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.S_===t&&this.K_(e,n)},t=>{e(()=>{let e=new tY(tW.UNKNOWN,"Fetching auth token failed: "+t.message);return this.W_(e)})})}K_(e,t){let n=this.U_(this.S_);this.stream=this.G_(e,t),this.stream.e_(()=>{n(()=>this.listener.e_())}),this.stream.n_(()=>{n(()=>(this.state=2,this.D_=this.xi.enqueueAfterDelay(this.w_,1e4,()=>(this.M_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(e=>{n(()=>this.W_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.v_?this.z_(e):this.onNext(e))})}x_(){this.state=5,this.C_.f_(async()=>{this.state=0,this.start()})}W_(e){return t$(sB,`close with error: ${e}`),this.stream=null,this.close(4,e)}U_(e){return t=>{this.xi.enqueueAndForget(()=>this.S_===e?t():(t$(sB,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class sj extends sF{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}G_(e,t){return this.connection.T_("Listen",e,t)}z_(e){return this.onNext(e)}onNext(e){this.C_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:tH(39313,{state:r}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(tQ(void 0===i||"string"==typeof i,58123),nA.fromBase64String(i||"")):(tQ(void 0===i||i instanceof tn||i instanceof Uint8Array,16193),nA.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new iI(s,a,o,l&&new tY(void 0===l.code?tW.UNKNOWN:ip(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=ij(e,r.document.name),s=iP(r.document.updateTime),a=r.document.createTime?iP(r.document.createTime):nr.min(),o=new n9({mapValue:{fields:r.document.fields}}),l=re.newFoundDocument(i,s,a,o);n=new i_(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=ij(e,r.document),s=r.readTime?iP(r.readTime):nr.min(),a=re.newNoDocument(i,s);n=new i_([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=ij(e,r.document);n=new i_([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return tH(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new id(r,i);n=new iT(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return nr.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?nr.min():t.readTime?iP(t.readTime):nr.min()}(e);return this.listener.j_(t,n)}H_(e){let t={};t.database=iq(this.serializer),t.addTarget=function(e,t){let n,r=t.target;if((n=r_(r)?{documents:{documents:[i$(e,r.path)]}}:{query:function(e,t){var n,r;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=i$(e,i);let o=function(e){if(0!==e.length)return function e(t){return t instanceof ra?function(e){if("=="===e.op){if(n3(e.value))return{unaryFilter:{field:iH(e.field),op:"IS_NAN"}};if(n6(e.value))return{unaryFilter:{field:iH(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(n3(e.value))return{unaryFilter:{field:iH(e.field),op:"IS_NOT_NAN"}};if(n6(e.value))return{unaryFilter:{field:iH(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:iH(e.field),op:iN[e.op],value:e.value}}}(t):t instanceof ro?function(t){let n=t.getFilters().map(t=>e(t));return 1===n.length?n[0]:{compositeFilter:{op:ik[t.op],filters:n}}}(t):tH(54877,{filter:t})}(ro.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:iH(e.field),direction:iD[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=iL(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),{gt:s,parent:i}}(e,r).gt}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=iM(e,t.resumeToken);let r=iL(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(nr.min())>0){n.readTime=iO(e,t.snapshotVersion.toTimestamp());let r=iL(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let n=function(e,t){let n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return tH(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.L_(t)}J_(e){let t={};t.database=iq(this.serializer),t.removeTarget=e,this.L_(t)}}class s$ extends sF{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get Y_(){return this.v_>0}start(){this.lastStreamToken=void 0,super.start()}Q_(){this.Y_&&this.Z_([])}G_(e,t){return this.connection.T_("Write",e,t)}z_(e){return tQ(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,tQ(!e.writeResults||0===e.writeResults.length,55816),this.listener.X_()}onNext(e){var t,n;tQ(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.C_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(tQ(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?iP(e.updateTime):iP(n)).isEqual(nr.min())&&(t=iP(n)),new r3(t,e.transformResults||[])})):[]),i=iP(e.commitTime);return this.listener.ea(i,r)}ta(){let e={};e.database=iq(this.serializer),this.L_(e)}Z_(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>(function(e,t){var n;let r;if(t instanceof it)r={update:iG(e,t.key,t.value)};else if(t instanceof io)r={delete:iF(e,t.key)};else if(t instanceof ir)r={update:iG(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof il))return tH(16599,{ft:t.type});r={verify:iF(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof rW)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof rY)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof rJ)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof r0)return{fieldPath:t.field.canonicalString(),increment:n.Re};throw tH(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(r.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:iO(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:tH(27497)),r})(this.serializer,e))};this.L_(t)}}class sq{}class sz extends sq{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.na=!1}ra(){if(this.na)throw new tY(tW.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,n,r){return this.ra(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.zo(e,iU(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tW.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tY(tW.UNKNOWN,e.toString())})}Yo(e,t,n,r,i){return this.ra(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Yo(e,iU(t,n),r,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tW.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tY(tW.UNKNOWN,e.toString())})}terminate(){this.na=!0,this.connection.terminate()}}class sG{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.ia=0,this.sa=null,this.oa=!0}_a(){0===this.ia&&(this.aa("Unknown"),this.sa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.sa=null,this.ua("Backend didn't respond within 10 seconds."),this.aa("Offline"),Promise.resolve())))}ca(e){"Online"===this.state?this.aa("Unknown"):(this.ia++,this.ia>=1&&(this.la(),this.ua(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.aa("Offline")))}set(e){this.la(),this.ia=0,"Online"===e&&(this.oa=!1),this.aa(e)}aa(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ua(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.oa?(tq(t),this.oa=!1):t$("OnlineStateTracker",t)}la(){null!==this.sa&&(this.sa.cancel(),this.sa=null)}}const sH="RemoteStore";class sK{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.ha=[],this.Pa=new Map,this.Ta=new Set,this.Ia=[],this.Ea=i,this.Ea.No(e=>{n.enqueueAndForget(async()=>{s2(this)&&(t$(sH,"Restarting streams for network reachability change."),await async function(e){e.Ta.add(4),await sW(e),e.da.set("Unknown"),e.Ta.delete(4),await sQ(e)}(this))})}),this.da=new sG(n,r)}}async function sQ(e){if(s2(e))for(let t of e.Ia)await t(!0)}async function sW(e){for(let t of e.Ia)await t(!1)}function sY(e,t){e.Pa.has(t.targetId)||(e.Pa.set(t.targetId,t),s1(e)?s0(e):al(e).M_()&&sJ(e,t))}function sX(e,t){let n=al(e);e.Pa.delete(t),n.M_()&&sZ(e,t),0===e.Pa.size&&(n.M_()?n.N_():s2(e)&&e.da.set("Unknown"))}function sJ(e,t){if(e.Aa.Ke(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(nr.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}al(e).H_(t)}function sZ(e,t){e.Aa.Ke(t),al(e).J_(t)}function s0(e){e.Aa=new iS({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Rt:t=>e.Pa.get(t)||null,Pt:()=>e.datastore.serializer.databaseId}),al(e).start(),e.da._a()}function s1(e){return s2(e)&&!al(e).F_()&&e.Pa.size>0}function s2(e){return 0===e.Ta.size}async function s6(e){e.da.set("Online")}async function s3(e){e.Pa.forEach((t,n)=>{sJ(e,t)})}async function s5(e,t){e.Aa=void 0,s1(e)?(e.da.ca(t),s0(e)):e.da.set("Unknown")}async function s4(e,t,n){if(e.da.set("Online"),t instanceof iI&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Pa.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Pa.delete(r),e.Aa.removeTarget(r))}(e,t)}catch(n){t$(sH,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await s8(e,n)}else if(t instanceof i_?e.Aa.Xe(t):t instanceof iT?e.Aa.ot(t):e.Aa.nt(t),!n.isEqual(nr.min()))try{let t=await sb(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.Aa.It(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.Pa.get(r);i&&e.Pa.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let r=e.Pa.get(t);if(!r)return;e.Pa.set(t,r.withResumeToken(nA.EMPTY_BYTE_STRING,r.snapshotVersion)),sZ(e,t);let i=new iW(r.target,t,n,r.sequenceNumber);sJ(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){t$(sH,"Failed to raise snapshot:",t),await s8(e,t)}}async function s8(e,t,n){if(!np(t))throw t;e.Ta.add(1),await sW(e),e.da.set("Offline"),n||(n=()=>sb(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{t$(sH,"Retrying IndexedDB access"),await n(),e.Ta.delete(1),await sQ(e)})}function s7(e,t){return t().catch(n=>s8(e,n,t))}async function s9(e){var t;let n=au(e),r=e.ha.length>0?e.ha[e.ha.length-1].batchId:-1;for(;s2(t=e)&&t.ha.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.ha.length&&n.N_();break}r=t.batchId,function(e,t){e.ha.push(t);let n=au(e);n.M_()&&n.Y_&&n.Z_(t.mutations)}(e,t)}catch(t){await s8(e,t)}ae(e)&&at(e)}function ae(e){return s2(e)&&!au(e).F_()&&e.ha.length>0}function at(e){au(e).start()}async function an(e){au(e).ta()}async function ar(e){let t=au(e);for(let n of e.ha)t.Z_(n.mutations)}async function ai(e,t,n){let r=e.ha.shift(),i=ih.from(r,t,n);await s7(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await s9(e)}async function as(e,t){t&&au(e).Y_&&await async function(e,t){var n;if(function(e){switch(e){case tW.OK:return tH(64938);case tW.CANCELLED:case tW.UNKNOWN:case tW.DEADLINE_EXCEEDED:case tW.RESOURCE_EXHAUSTED:case tW.INTERNAL:case tW.UNAVAILABLE:case tW.UNAUTHENTICATED:return!1;case tW.INVALID_ARGUMENT:case tW.NOT_FOUND:case tW.ALREADY_EXISTS:case tW.PERMISSION_DENIED:case tW.FAILED_PRECONDITION:case tW.ABORTED:case tW.OUT_OF_RANGE:case tW.UNIMPLEMENTED:case tW.DATA_LOSS:return!0;default:return tH(15467,{code:e})}}(n=t.code)&&n!==tW.ABORTED){let n=e.ha.shift();au(e).O_(),await s7(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await s9(e)}}(e,t),ae(e)&&at(e)}async function aa(e,t){e.asyncQueue.verifyOperationInProgress(),t$(sH,"RemoteStore received new credentials");let n=s2(e);e.Ta.add(3),await sW(e),n&&e.da.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ta.delete(3),await sQ(e)}async function ao(e,t){t?(e.Ta.delete(2),await sQ(e)):t||(e.Ta.add(2),await sW(e),e.da.set("Unknown"))}function al(e){var t,n,r;return e.Ra||(t=e.datastore,n=e.asyncQueue,r={e_:s6.bind(null,e),n_:s3.bind(null,e),i_:s5.bind(null,e),j_:s4.bind(null,e)},t.ra(),e.Ra=new sj(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.Ia.push(async t=>{t?(e.Ra.O_(),s1(e)?s0(e):e.da.set("Unknown")):(await e.Ra.stop(),e.Aa=void 0)})),e.Ra}function au(e){var t,n,r;return e.Va||(t=e.datastore,n=e.asyncQueue,r={e_:()=>Promise.resolve(),n_:an.bind(null,e),i_:as.bind(null,e),X_:ar.bind(null,e),ea:ai.bind(null,e)},t.ra(),e.Va=new s$(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.Ia.push(async t=>{t?(e.Va.O_(),await s9(e)):(await e.Va.stop(),e.ha.length>0&&(t$(sH,`Stopping write stream with ${e.ha.length} pending writes`),e.ha=[]))})),e.Va}class ah{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new tX,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new ah(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new tY(tW.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ac(e,t){if(tq("AsyncQueue",`${t}: ${e}`),np(e))return new tY(tW.UNAVAILABLE,`${t}: ${e}`);throw e}class af{static emptySet(e){return new af(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||nu.comparator(t.key,n.key):(e,t)=>nu.comparator(e.key,t.key),this.keyedMap=rU(),this.sortedSet=new nb(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof af)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new af;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class ad{constructor(){this.ma=new nb(nu.comparator)}track(e){let t=e.doc.key,n=this.ma.get(t);n?0!==e.type&&3===n.type?this.ma=this.ma.insert(t,e):3===e.type&&1!==n.type?this.ma=this.ma.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ma=this.ma.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ma=this.ma.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ma=this.ma.remove(t):1===e.type&&2===n.type?this.ma=this.ma.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ma=this.ma.insert(t,{type:2,doc:e.doc}):tH(63341,{Vt:e,fa:n}):this.ma=this.ma.insert(t,e)}ga(){let e=[];return this.ma.inorderTraversal((t,n)=>{e.push(n)}),e}}class ap{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new ap(e,t,af.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&rN(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class ag{constructor(){this.pa=void 0,this.ya=[]}wa(){return this.ya.some(e=>e.Sa())}}class am{constructor(){this.queries=ay(),this.onlineState="Unknown",this.ba=new Set}terminate(){!function(e,t){let n=e.queries;e.queries=ay(),n.forEach((e,n)=>{for(let e of n.ya)e.onError(t)})}(this,new tY(tW.ABORTED,"Firestore shutting down"))}}function ay(){return new rM(e=>rk(e),rN)}async function av(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.wa()&&t.Sa()&&(n=2):(i=new ag,n=+!t.Sa());try{switch(n){case 0:i.pa=await e.onListen(r,!0);break;case 1:i.pa=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=ac(n,`Initialization of query '${rR(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.ya.push(t),t.Da(e.onlineState),i.pa&&t.va(i.pa)&&a_(e)}async function aw(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.ya.indexOf(t);e>=0&&(i.ya.splice(e,1),0===i.ya.length?r=+!t.Sa():!i.wa()&&t.Sa()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function ab(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.ya)e.va(r)&&(n=!0);i.pa=r}}n&&a_(e)}function aE(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.ya)e.onError(n);e.queries.delete(t)}function a_(e){e.ba.forEach(e=>{e.next()})}(_=E||(E={})).Ca="default",_.Cache="cache";class aT{constructor(e,t,n){this.query=e,this.Fa=t,this.Ma=!1,this.xa=null,this.onlineState="Unknown",this.options=n||{}}va(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new ap(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Ma?this.Oa(e)&&(this.Fa.next(e),t=!0):this.Na(e,this.onlineState)&&(this.Ba(e),t=!0),this.xa=e,t}onError(e){this.Fa.error(e)}Da(e){this.onlineState=e;let t=!1;return this.xa&&!this.Ma&&this.Na(this.xa,e)&&(this.Ba(this.xa),t=!0),t}Na(e,t){return!(e.fromCache&&this.Sa())||(!this.options.La||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Oa(e){if(e.docChanges.length>0)return!0;let t=this.xa&&this.xa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Ba(e){e=ap.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Ma=!0,this.Fa.next(e)}Sa(){return this.options.source!==E.Cache}}class aI{constructor(e){this.key=e}}class aC{constructor(e){this.key=e}}class aS{constructor(e,t){this.query=e,this.Ga=t,this.za=null,this.hasCachedResults=!1,this.current=!1,this.ja=rq(),this.mutatedKeys=rq(),this.Ha=rO(e),this.Ja=new af(this.Ha)}get Ya(){return this.Ga}Za(e,t){let n=t?t.Xa:new ad,r=t?t.Ja:this.Ja,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),h=rL(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),f=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),d=!1;u&&h?u.data.isEqual(h.data)?c!==f&&(n.track({type:3,doc:h}),d=!0):this.eu(u,h)||(n.track({type:2,doc:h}),d=!0,(o&&this.Ha(h,o)>0||l&&0>this.Ha(h,l))&&(a=!0)):!u&&h?(n.track({type:0,doc:h}),d=!0):u&&!h&&(n.track({type:1,doc:u}),d=!0,(o||l)&&(a=!0)),d&&(h?(s=s.add(h),i=f?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ja:s,Xa:n,Cs:a,mutatedKeys:i}}eu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.Ja;this.Ja=e.Ja,this.mutatedKeys=e.mutatedKeys;let s=e.Xa.ga();s.sort((e,t)=>(function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return tH(20277,{Vt:e})}};return n(e)-n(t)})(e.type,t.type)||this.Ha(e.doc,t.doc)),this.tu(n),r=null!=r&&r;let a=t&&!r?this.nu():[],o=0===this.ja.size&&this.current&&!r?1:0,l=o!==this.za;return(this.za=o,0!==s.length||l)?{snapshot:new ap(this.query,e.Ja,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),ru:a}:{ru:a}}Da(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ja:this.Ja,Xa:new ad,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ru:[]}}iu(e){return!this.Ga.has(e)&&!!this.Ja.has(e)&&!this.Ja.get(e).hasLocalMutations}tu(e){e&&(e.addedDocuments.forEach(e=>this.Ga=this.Ga.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ga=this.Ga.delete(e)),this.current=e.current)}nu(){if(!this.current)return[];let e=this.ja;this.ja=rq(),this.Ja.forEach(e=>{this.iu(e.key)&&(this.ja=this.ja.add(e.key))});let t=[];return e.forEach(e=>{this.ja.has(e)||t.push(new aC(e))}),this.ja.forEach(n=>{e.has(n)||t.push(new aI(n))}),t}su(e){this.Ga=e.$s,this.ja=rq();let t=this.Za(e.documents);return this.applyChanges(t,!0)}ou(){return ap.fromInitialDocuments(this.query,this.Ja,this.mutatedKeys,0===this.za,this.hasCachedResults)}}const aA="SyncEngine";class ax{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class aD{constructor(e){this.key=e,this._u=!1}}class aN{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.au={},this.uu=new rM(e=>rk(e),rN),this.cu=new Map,this.lu=new Set,this.hu=new nb(nu.comparator),this.Pu=new Map,this.Tu=new si,this.Iu={},this.Eu=new Map,this.du=i2.lr(),this.onlineState="Unknown",this.Au=void 0}get isPrimaryClient(){return!0===this.Au}}async function ak(e,t,n=!0){let r,i=aJ(e),s=i.uu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.ou()):r=await aL(i,t,n,!0),r}async function aR(e,t){let n=aJ(e);await aL(n,t,!0,!1)}async function aL(e,t,n,r){var i,s;let a,o=await (i=e.localStore,s=rA(t),i.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return i.Ti.getTargetData(e,s).next(n=>n?(t=n,nd.resolve(t)):i.Ti.allocateTargetId(e).next(n=>(t=new iW(s,n,"TargetPurposeListen",e.currentSequenceNumber),i.Ti.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=i.xs.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(i.xs=i.xs.insert(e.targetId,e),i.Os.set(s,e.targetId)),e})),l=o.targetId,u=e.sharedClientState.addLocalQueryTarget(l,n);return r&&(a=await aO(e,t,l,"current"===u,o.resumeToken)),e.isPrimaryClient&&n&&sY(e.remoteStore,o),a}async function aO(e,t,n,r,i){e.Ru=(t,n,r)=>(async function(e,t,n,r){let i=t.view.Za(n);i.Cs&&(i=await s_(e.localStore,t.query,!1).then(({documents:e})=>t.view.Za(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return aK(e,t.targetId,o.ru),o.snapshot})(e,t,n,r);let s=await s_(e.localStore,t,!0),a=new aS(t,s.$s),o=a.Za(s.documents),l=iE.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);aK(e,n,u.ru);let h=new ax(t,n,a);return e.uu.set(t,h),e.cu.has(n)?e.cu.get(n).push(t):e.cu.set(n,[t]),u.snapshot}async function aM(e,t,n){let r=e.uu.get(t),i=e.cu.get(r.targetId);if(i.length>1)return e.cu.set(r.targetId,i.filter(e=>!rN(e,t))),void e.uu.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await sE(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&sX(e.remoteStore,r.targetId),aG(e,r.targetId)}).catch(nf)):(aG(e,r.targetId),await sE(e.localStore,r.targetId,!0))}async function aP(e,t){let n=e.uu.get(t),r=e.cu.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),sX(e.remoteStore,n.targetId))}async function aV(e,t,n){var r,i;let s=((r=e).remoteStore.remoteSyncer.applySuccessfulWrite=aj.bind(null,r),r.remoteStore.remoteSyncer.rejectFailedWrite=a$.bind(null,r),r);try{let e,r=await function(e,t){let n,r,i=nn.now(),s=t.reduce((e,t)=>e.add(t.key),rq());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let o=rP,l=rq();return e.Bs.getEntries(a,s).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,o)).next(r=>{n=r;let s=[];for(let e of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=rQ(r.transform,e||null);null!=i&&(null===n&&(n=n9.empty()),n.set(r.field,i))}return n||null}(e,n.get(e.key).overlayedDocument);null!=t&&s.push(new ir(e.key,t,function e(t){let n=[];return nv(t.fields,(t,r)=>{let i=new nl([t]);if(n5(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new nC(n)}(t.value.mapValue),r5.exists(!0)))}return e.mutationQueue.addMutationBatch(a,i,s,t)}).next(t=>{r=t;let i=t.applyToLocalDocumentSet(n,l);return e.documentOverlayCache.saveOverlays(a,t.batchId,i)})}).then(()=>({batchId:r.batchId,changes:rB(n)}))}(s.localStore,t);s.sharedClientState.addPendingMutation(r.batchId),i=r.batchId,(e=s.Iu[s.currentUser.toKey()])||(e=new nb(t7)),e=e.insert(i,n),s.Iu[s.currentUser.toKey()]=e,await aW(s,r.changes),await s9(s.remoteStore)}catch(t){let e=ac(t,"Failed to persist write");n.reject(e)}}async function aU(e,t){try{let n=await function(e,t){let n=t.snapshotVersion,r=e.xs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{var s,a,o;let l,u,h=e.Bs.newChangeBuffer({trackRemovals:!0});r=e.xs;let c=[];t.targetChanges.forEach((s,a)=>{var o;let l=r.get(a);if(!l)return;c.push(e.Ti.removeMatchingKeys(i,s.removedDocuments,a).next(()=>e.Ti.addMatchingKeys(i,s.addedDocuments,a)));let u=l.withSequenceNumber(i.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(nA.EMPTY_BYTE_STRING,nr.min()).withLastLimboFreeSnapshotVersion(nr.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,n)),r=r.insert(a,u),o=u,(0===l.resumeToken.approximateByteSize()||o.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&c.push(e.Ti.updateTargetData(i,u))});let f=rP,d=rq();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&c.push(e.persistence.referenceDelegate.updateLimboDocument(i,n))}),c.push((s=i,a=h,o=t.documentUpdates,l=rq(),u=rq(),o.forEach(e=>l=l.add(e)),a.getEntries(s,l).next(e=>{let t=rP;return o.forEach((n,r)=>{let i=e.get(n);r.isFoundDocument()!==i.isFoundDocument()&&(u=u.add(n)),r.isNoDocument()&&r.version.isEqual(nr.min())?(a.removeEntry(n,r.readTime),t=t.insert(n,r)):!i.isValidDocument()||r.version.compareTo(i.version)>0||0===r.version.compareTo(i.version)&&i.hasPendingWrites?(a.addEntry(r),t=t.insert(n,r)):t$(sy,"Ignoring outdated watch update for ",n,". Current version:",i.version," Watch version:",r.version)}),{qs:t,Qs:u}})).next(e=>{f=e.qs,d=e.Qs})),!n.isEqual(nr.min())){let t=e.Ti.getLastRemoteSnapshotVersion(i).next(t=>e.Ti.setTargetsMetadata(i,i.currentSequenceNumber,n));c.push(t)}return nd.waitFor(c).next(()=>h.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,f,d)).next(()=>f)}).then(t=>(e.xs=r,t))}(e.localStore,t);t.targetChanges.forEach((t,n)=>{let r=e.Pu.get(n);r&&(tQ(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r._u=!0:t.modifiedDocuments.size>0?tQ(r._u,14607):t.removedDocuments.size>0&&(tQ(r._u,42227),r._u=!1))}),await aW(e,n,t)}catch(e){await nf(e)}}function aB(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.uu.forEach((e,n)=>{let r=n.view.Da(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.ya)e.Da(t)&&(n=!0)}),n&&a_(r),i.length&&e.au.j_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function aF(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Pu.get(t),i=r&&r.key;if(i){let n=new nb(nu.comparator);n=n.insert(i,re.newNoDocument(i,nr.min()));let r=rq().add(i),s=new ib(nr.min(),new Map,new nb(t7),n,r);await aU(e,s),e.hu=e.hu.remove(i),e.Pu.delete(t),aQ(e)}else await sE(e.localStore,t,!1).then(()=>aG(e,t,n)).catch(nf)}async function aj(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r=t.batch.keys(),i=n.Bs.newChangeBuffer({trackRemovals:!0});return(function(e,t,n,r){let i=n.batch,s=i.keys(),a=nd.resolve();return s.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);tQ(null!==s,48541),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))})(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=rq();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))}));az(e,r,null),aq(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await aW(e,i)}catch(e){await nf(e)}}async function a$(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(tQ(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));az(e,t,n),aq(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await aW(e,i)}catch(e){await nf(e)}}function aq(e,t){(e.Eu.get(t)||[]).forEach(e=>{e.resolve()}),e.Eu.delete(t)}function az(e,t,n){let r=e.Iu[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Iu[e.currentUser.toKey()]=r}}function aG(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.cu.get(t)))e.uu.delete(r),n&&e.au.Vu(r,n);e.cu.delete(t),e.isPrimaryClient&&e.Tu.Hr(t).forEach(t=>{e.Tu.containsKey(t)||aH(e,t)})}function aH(e,t){e.lu.delete(t.path.canonicalString());let n=e.hu.get(t);null!==n&&(sX(e.remoteStore,n),e.hu=e.hu.remove(t),e.Pu.delete(n),aQ(e))}function aK(e,t,n){for(let r of n)r instanceof aI?(e.Tu.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.hu.get(n)||e.lu.has(r)||(t$(aA,"New document in limbo: "+n),e.lu.add(r),aQ(e))}(e,r)):r instanceof aC?(t$(aA,"Document no longer in limbo: "+r.key),e.Tu.removeReference(r.key,t),e.Tu.containsKey(r.key)||aH(e,r.key)):tH(19791,{mu:r})}function aQ(e){for(;e.lu.size>0&&e.hu.size<e.maxConcurrentLimboResolutions;){let t=e.lu.values().next().value;e.lu.delete(t);let n=new nu(na.fromString(t)),r=e.du.next();e.Pu.set(r,new aD(n)),e.hu=e.hu.insert(n,r),sY(e.remoteStore,new iW(rA(new rT(n.path)),r,"TargetPurposeLimboResolution",ng.le))}}async function aW(e,t,n){let r=[],i=[],s=[];e.uu.isEmpty()||(e.uu.forEach((a,o)=>{s.push(e.Ru(o,t,n).then(t=>{var s;if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:null==(s=null==n?void 0:n.targetChanges.get(o.targetId))?void 0:s.current;e.sharedClientState.updateQueryState(o.targetId,r?"current":"not-current")}if(t){r.push(t);let e=sp.Rs(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.au.j_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>nd.forEach(t,t=>nd.forEach(t.ds,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>nd.forEach(t.As,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!np(e))throw e;t$(sy,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.xs.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.xs=e.xs.insert(t,i)}}}(e.localStore,i))}async function aY(e,t){if(!e.currentUser.isEqual(t)){t$(aA,"User change. New user:",t.toKey());let n=await sw(e.localStore,t);e.currentUser=t,e.Eu.forEach(e=>{e.forEach(e=>{e.reject(new tY(tW.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Eu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await aW(e,n.ks)}}function aX(e,t){let n=e.Pu.get(t);if(n&&n._u)return rq().add(n.key);{let n=rq(),r=e.cu.get(t);if(!r)return n;for(let t of r){let r=e.uu.get(t);n=n.unionWith(r.view.Ya)}return n}}function aJ(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=aU.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=aX.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=aF.bind(null,e),e.au.j_=ab.bind(null,e.eventManager),e.au.Vu=aE.bind(null,e.eventManager),e}class aZ{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=sV(e.databaseInfo.databaseId),this.sharedClientState=this.pu(e),this.persistence=this.yu(e),await this.persistence.start(),this.localStore=this.wu(e),this.gcScheduler=this.Su(e,this.localStore),this.indexBackfillerScheduler=this.bu(e,this.localStore)}Su(e,t){return null}bu(e,t){return null}wu(e){var t,n;return t=this.persistence,n=new sm,new sv(t,n,e.initialUser,this.serializer)}yu(e){return new sh(sf.fi,this.serializer)}pu(e){return new sI}async terminate(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}aZ.provider={build:()=>new aZ};class a0 extends aZ{constructor(e){super(),this.cacheSizeBytes=e}Su(e,t){return tQ(this.persistence.referenceDelegate instanceof sd,46915),new i4(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}yu(e){let t=void 0!==this.cacheSizeBytes?i1.withCacheSize(this.cacheSizeBytes):i1.DEFAULT;return new sh(e=>sd.fi(e,t),this.serializer)}}class a1{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>aB(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=aY.bind(null,this.syncEngine),await ao(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new am}createDatastore(e){var t;let n=sV(e.databaseInfo.databaseId),r=new sM(e.databaseInfo);return t=e.authCredentials,new sz(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new sK(t,n,e.asyncQueue,e=>aB(this.syncEngine,e,0),sA.C()?new sA:new sC)}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){let o=new aN(e,t,n,r,i,s);return a&&(o.Au=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){t$(sH,"RemoteStore shutting down."),e.Ta.add(5),await sW(e),e.Ea.shutdown(),e.da.set("Unknown")}(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()}}a1.provider={build:()=>new a1};class a2{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.vu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.vu(this.observer.error,e):tq("Uncaught Error in snapshot listener:",e.toString()))}Cu(){this.muted=!0}vu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const a6="FirestoreClient";class a3{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=tU.UNAUTHENTICATED,this.clientId=t8.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{t$(a6,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(t$(a6,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new tX;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=ac(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function a5(e,t){e.asyncQueue.verifyOperationInProgress(),t$(a6,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await sw(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function a4(e,t){e.asyncQueue.verifyOperationInProgress();let n=await a8(e);t$(a6,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>aa(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>aa(t.remoteStore,n)),e._onlineComponents=t}async function a8(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){t$(a6,"Using user provided OfflineComponentProvider");try{await a5(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===tW.FAILED_PRECONDITION||t.code===tW.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;tz("Error using user provided cache. Falling back to memory cache: "+t),await a5(e,new aZ)}}else t$(a6,"Using default OfflineComponentProvider"),await a5(e,new a0(void 0));return e._offlineComponents}async function a7(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(t$(a6,"Using user provided OnlineComponentProvider"),await a4(e,e._uninitializedComponentsProvider._online)):(t$(a6,"Using default OnlineComponentProvider"),await a4(e,new a1))),e._onlineComponents}async function a9(e){let t=await a7(e),n=t.eventManager;return n.onListen=ak.bind(null,t.syncEngine),n.onUnlisten=aM.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=aR.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=aP.bind(null,t.syncEngine),n}function oe(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const ot=new Map;function on(e,t,n){if(!n)throw new tY(tW.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function or(e){if(!nu.isDocumentKey(e))throw new tY(tW.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function oi(e){if(nu.isDocumentKey(e))throw new tY(tW.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function os(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":tH(12329,{type:typeof e})}function oa(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new tY(tW.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=os(e);throw new tY(tW.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}const oo="firestore.googleapis.com";class ol{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new tY(tW.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=oo,this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new tY(tW.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new tY(tW.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=oe(null!=(n=e.experimentalLongPollingOptions)?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new tY(tW.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new tY(tW.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new tY(tW.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ou{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ol({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new tY(tW.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new tY(tW.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ol(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new tZ;switch(e.type){case"firstParty":return new t6(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new tY(tW.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,Z("Firestore",this._settings.isUsingEmulator),this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=ot.get(e);t&&(t$("ComponentProvider","Removing Datastore"),ot.delete(e),t.terminate())}(this),Promise.resolve()}}class oh{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new oh(this.firestore,e,this._query)}}class oc{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new of(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new oc(this.firestore,e,this._key)}}class of extends oh{constructor(e,t,n){super(e,t,new rT(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new oc(this.firestore,null,new nu(e))}withConverter(e){return new of(this.firestore,e,this._path)}}function od(e,t,...n){if(e=es(e),1==arguments.length&&(t=t8.newId()),on("doc","path",t),e instanceof ou){let r=na.fromString(t,...n);return or(r),new oc(e,null,new nu(r))}{if(!(e instanceof oc||e instanceof of))throw new tY(tW.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(na.fromString(t,...n));return or(r),new oc(e.firestore,e instanceof of?e.converter:null,new nu(r))}}const op="AsyncQueue";class og{constructor(e=Promise.resolve()){this.zu=[],this.ju=!1,this.Hu=[],this.Ju=null,this.Yu=!1,this.Zu=!1,this.Xu=[],this.C_=new sU(this,"async_queue_retry"),this.ec=()=>{let e=sP();e&&t$(op,"Visibility state changed to "+e.visibilityState),this.C_.p_()},this.tc=e;let t=sP();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.ec)}get isShuttingDown(){return this.ju}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.nc(),this.rc(e)}enterRestrictedMode(e){if(!this.ju){this.ju=!0,this.Zu=e||!1;let t=sP();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ec)}}enqueue(e){if(this.nc(),this.ju)return new Promise(()=>{});let t=new tX;return this.rc(()=>this.ju&&this.Zu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.zu.push(e),this.sc()))}async sc(){if(0!==this.zu.length){try{await this.zu[0](),this.zu.shift(),this.C_.reset()}catch(e){if(!np(e))throw e;t$(op,"Operation failed with retryable error: "+e)}this.zu.length>0&&this.C_.f_(()=>this.sc())}}rc(e){let t=this.tc.then(()=>(this.Yu=!0,e().catch(e=>{throw this.Ju=e,this.Yu=!1,tq("INTERNAL UNHANDLED ERROR: ",om(e)),e}).then(e=>(this.Yu=!1,e))));return this.tc=t,t}enqueueAfterDelay(e,t,n){this.nc(),this.Xu.indexOf(e)>-1&&(t=0);let r=ah.createAndSchedule(this,e,t,n,e=>this.oc(e));return this.Hu.push(r),r}nc(){this.Ju&&tH(47125,{_c:om(this.Ju)})}verifyOperationInProgress(){}async ac(){let e;do e=this.tc,await e;while(e!==this.tc)}uc(e){for(let t of this.Hu)if(t.timerId===e)return!0;return!1}cc(e){return this.ac().then(()=>{for(let t of(this.Hu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.Hu))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.ac()})}lc(e){this.Xu.push(e)}oc(e){let t=this.Hu.indexOf(e);this.Hu.splice(t,1)}}function om(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class oy extends ou{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new og,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new og(e),this._firestoreClient=void 0,await e}}}function ov(e){if(e._terminated)throw new tY(tW.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,r,i,s;let a=e._freezeSettings(),o=(i=e._databaseId,s=(null==(t=e._app)?void 0:t.options.appId)||"",new nB(i,s,e._persistenceKey,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,oe(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator));e._componentsProvider||(null==(n=a.localCache)?void 0:n._offlineComponentProvider)&&(null==(r=a.localCache)?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),e._firestoreClient=new a3(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&function(e){let t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class ow{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ow(nA.fromBase64String(e))}catch(e){throw new tY(tW.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new ow(nA.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ob{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new tY(tW.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new nl(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class oE{constructor(e){this._methodName=e}}class o_{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new tY(tW.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new tY(tW.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return t7(this._lat,e._lat)||t7(this._long,e._long)}}class oT{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const oI=/^__.*__$/;class oC{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ir(e,this.data,this.fieldMask,t,this.fieldTransforms):new it(e,this.data,t,this.fieldTransforms)}}class oS{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new ir(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function oA(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw tH(40011,{hc:e})}}class ox{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Pc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get hc(){return this.settings.hc}Tc(e){return new ox(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ic(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.Tc({path:n,Ec:!1});return r.dc(e),r}Ac(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.Tc({path:n,Ec:!1});return r.Pc(),r}Rc(e){return this.Tc({path:void 0,Ec:!0})}Vc(e){return oF(e,this.settings.methodName,this.settings.mc||!1,this.path,this.settings.fc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Pc(){if(this.path)for(let e=0;e<this.path.length;e++)this.dc(this.path.get(e))}dc(e){if(0===e.length)throw this.Vc("Document fields must not be empty");if(oA(this.hc)&&oI.test(e))throw this.Vc('Document fields cannot begin and end with "__"')}}class oD{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||sV(e)}gc(e,t,n,r=!1){return new ox({hc:e,methodName:t,fc:n,path:nl.emptyPath(),Ec:!1,mc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function oN(e){let t=e._freezeSettings(),n=sV(e._databaseId);return new oD(e._databaseId,!!t.ignoreUndefinedProperties,n)}class ok extends oE{_toFieldTransform(e){if(2!==e.hc)throw 1===e.hc?e.Vc(`${this._methodName}() can only appear at the top level of your update data`):e.Vc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ok}}class oR extends oE{_toFieldTransform(e){return new r6(e.path,new rW)}isEqual(e){return e instanceof oR}}function oL(e,t){if(oM(e=es(e)))return oP("Unsupported field value:",t,e),oO(e,t);if(e instanceof oE)return function(e,t){if(!oA(t.hc))throw t.Vc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Vc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Ec&&4!==t.hc)throw t.Vc("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=oL(i,t.Rc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}return function(e,t){var n,r,i;if(null===(e=es(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return n=t.serializer,"number"==typeof(i=r=e)&&Number.isInteger(i)&&!nm(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER?rH(r):rG(n,r);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=nn.fromDate(e);return{timestampValue:iO(t.serializer,n)}}if(e instanceof nn){let n=new nn(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:iO(t.serializer,n)}}if(e instanceof o_)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof ow)return{bytesValue:iM(t.serializer,e._byteString)};if(e instanceof oc){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Vc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:iV(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof oT)return{mapValue:{fields:{[n$]:{stringValue:nG},[nH]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Vc("VectorValues must only contain numeric values.");return rG(t.serializer,e)})}}}}};throw t.Vc(`Unsupported field value: ${os(e)}`)}(e,t)}function oO(e,t){let n={};return nw(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):nv(e,(e,r)=>{let i=oL(r,t.Ic(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function oM(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof nn||e instanceof o_||e instanceof ow||e instanceof oc||e instanceof oE||e instanceof oT)}function oP(e,t,n){if(!oM(n)||"object"!=typeof n||null===n||Object.getPrototypeOf(n)!==Object.prototype&&null!==Object.getPrototypeOf(n)){let r=os(n);throw"an object"===r?t.Vc(e+" a custom object"):t.Vc(e+" "+r)}}function oV(e,t,n){if((t=es(t))instanceof ob)return t._internalPath;if("string"==typeof t)return oB(e,t);throw oF("Field path arguments must be of type string or ",e,!1,void 0,n)}const oU=RegExp("[~\\*/\\[\\]]");function oB(e,t,n){if(t.search(oU)>=0)throw oF(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new ob(...t.split("."))._internalPath}catch(r){throw oF(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function oF(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new tY(tW.INVALID_ARGUMENT,o+e+l)}function oj(e,t){return e.some(e=>e.isEqual(t))}class o${constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new oc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new oq(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(oz("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class oq extends o${data(){return super.data()}}function oz(e,t){return"string"==typeof t?oB(e,t):t instanceof ob?t._internalPath:t._delegate._internalPath}class oG{}class oH extends oG{}class oK extends oH{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new oK(e,t,n)}_apply(e){let t=this._parse(e);return oJ(e._query,t),new oh(e.firestore,e.converter,rx(e._query,t))}_parse(e){let t=oN(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new tY(tW.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){oX(a,s);let t=[];for(let n of a)t.push(oY(r,e,n));o={arrayValue:{values:t}}}else o=oY(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||oX(a,s),o=function(e,t,n,r=!1){return oL(n,e.gc(r?4:3,t))}(n,t,a,"in"===s||"not-in"===s);return ra.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class oQ extends oG{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new oQ(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:ro.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())oJ(n,e),n=rx(n,e)}(e._query,t),new oh(e.firestore,e.converter,rx(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class oW extends oH{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new oW(e,t)}_apply(e){let t=function(e,t,n){if(null!==e.startAt)throw new tY(tW.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new tY(tW.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ri(t,n)}(e._query,this._field,this._direction);return new oh(e.firestore,e.converter,function(e,t){let n=e.explicitOrderBy.concat([t]);return new rT(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function oY(e,t,n){if("string"==typeof(n=es(n))){if(""===n)throw new tY(tW.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!rC(t)&&-1!==n.indexOf("/"))throw new tY(tW.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(na.fromString(n));if(!nu.isDocumentKey(r))throw new tY(tW.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return n0(e,new nu(r))}if(n instanceof oc)return n0(e,n._key);throw new tY(tW.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${os(n)}.`)}function oX(e,t){if(!Array.isArray(e)||0===e.length)throw new tY(tW.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function oJ(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new tY(tW.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new tY(tW.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class oZ{convertValue(e,t="none"){switch(nK(e)){case 0:return null;case 1:return e.booleanValue;case 2:return nN(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nk(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw tH(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return nv(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,r;return new oT(null==(r=null==(n=null==(t=e.fields)?void 0:t[nH].arrayValue)?void 0:n.values)?void 0:r.map(e=>nN(e.doubleValue)))}convertGeoPoint(e){return new o_(nN(e.latitude),nN(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=nV(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(nU(e));default:return null}}convertTimestamp(e){let t=nD(e);return new nn(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=na.fromString(e);tQ(iQ(n),9688,{name:e});let r=new nj(n.get(1),n.get(3)),i=new nu(n.popFirst(5));return r.isEqual(t)||tq(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class o0{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class o1 extends o${constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new o2(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(oz("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class o2 extends o1{data(e={}){return super.data(e)}}class o6{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new o0(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new o2(this._firestore,this._userDataWriter,n.key,n,new o0(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new tY(tW.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new o2(e._firestore,e._userDataWriter,n.doc.key,n.doc,new o0(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new o2(e._firestore,e._userDataWriter,t.doc.key,t.doc,new o0(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return tH(61501,{type:e})}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}class o3 extends oZ{constructor(e){super(),this.firestore=e}convertBytes(e){return new ow(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new oc(this.firestore,null,t)}}function o5(e,t,n,...r){e=oa(e,oc);let i=oa(e.firestore,oy),s=oN(i);return o4(i,[("string"==typeof(t=es(t))||t instanceof ob?function(e,t,n,r,i,s){let a=e.gc(1,t,n),o=[oV(t,r,n)],l=[i];if(s.length%2!=0)throw new tY(tW.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(oV(t,s[e])),l.push(s[e+1]);let u=[],h=n9.empty();for(let e=o.length-1;e>=0;--e)if(!oj(u,o[e])){let t=o[e],n=l[e];n=es(n);let r=a.Ac(t);if(n instanceof ok)u.push(t);else{let e=oL(n,r);null!=e&&(u.push(t),h.set(t,e))}}return new oS(h,new nC(u),a.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){let i=e.gc(1,t,n);oP("Data must be an object, but it was:",i,r);let s=[],a=n9.empty();return nv(r,(e,r)=>{let o=oB(t,e,n);r=es(r);let l=i.Ac(o);if(r instanceof ok)s.push(o);else{let e=oL(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new oS(a,new nC(s),i.fieldTransforms)}(s,"updateDoc",e._key,t)).toMutation(e._key,r5.exists(!0))])}function o4(e,t){var n=ov(e);let r=new tX;return n.asyncQueue.enqueueAndForget(async()=>aV(await a7(n).then(e=>e.syncEngine),t,r)),r.promise}new WeakMap,function(e=!0){tB="11.8.0",eB(new ea("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new oy(new t1(t.getProvider("auth-internal")),new t5(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new tY(tW.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nj(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),eq(tP,tV,void 0),eq(tP,tV,"esm2017")}();var o8={};const o7=new URL(I("j8q2G")).href;var o9={};const le=new URL(I("9iuTZ")).href,lt=document.getElementById("addFilm_button"),ln=document.getElementById("addFilm_input"),lr={key:"movie",db:function(e,t){let n=(function(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)})("object"==typeof e?e:function(e=eL){let t=eM.get(e);if(!t&&e===eL&&K())return e$();if(!t)throw eF.create("no-app",{appName:e});return t}(),"firestore").getImmediate({identifier:"string"==typeof e?e:nF});if(!n._initialized){let e=H("firestore");e&&function(e,t,n,r={}){var i;e=oa(e,ou);let s=W(t),a=e._getSettings(),o=Object.assign(Object.assign({},a),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${n}`;a.host!==oo&&a.host!==l&&tz("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let u=Object.assign(Object.assign({},a),{host:l,ssl:s,emulatorOptions:r});if(!er(u,o)&&(e._setSettings(u),s&&(Y(`https://${l}`),Z("Firestore",!0)),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=tU.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[B(JSON.stringify({alg:"none",type:"JWT"})),B(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null==(i=e._app)?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new tY(tW.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new tU(s)}e._authCredentials=new t0(new tJ(t,n))}}(n,...e)}return n}(e$({apiKey:"AIzaSyBe-tvGVGQrpPfRU2nZm2wdYrkksTzoizk",authDomain:"todo-57a6a.firebaseapp.com",projectId:"todo-57a6a",storageBucket:"todo-57a6a.firebasestorage.app",messagingSenderId:"981261376104",appId:"1:981261376104:web:bfc9d99f67aa16915ab9dd"})),pull:async function(){let e=function(e,t,...n){let r=[];for(let i of(t instanceof oG&&r.push(t),function(e){let t=e.filter(e=>e instanceof oQ).length,n=e.filter(e=>e instanceof oK).length;if(t>1||t>0&&n>0)throw new tY(tW.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}(function(e,t,...n){if(e=es(e),on("collection","path",t),e instanceof ou){let r=na.fromString(t,...n);return oi(r),new of(e,null,r)}{if(!(e instanceof oc||e instanceof of))throw new tY(tW.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(na.fromString(t,...n));return oi(r),new of(e.firestore,null,r)}}(this.db,this.key),function(e,t="asc"){let n=oz("orderBy",e);return oW._create(n,t)}("createdAt")),t=await function(e){e=oa(e,oh);let t=oa(e.firestore,oy),n=ov(t),r=new o3(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new tY(tW.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),(function(e,t,n={}){let r=new tX;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new a2({next:n=>{s.Cu(),t.enqueueAndForget(()=>aw(e,a)),n.fromCache&&"server"===r.source?i.reject(new tY(tW.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),a=new aT(n,s,{includeMetadataChanges:!0,La:!0});return av(e,a)})(await a9(e),e.asyncQueue,t,n,r)),r.promise})(n,e._query).then(n=>new o6(t,r,e,n))}(e),n=[];return t.forEach(e=>{n.push({id:e.id,name:e.data().name,done:e.data().done})}),n},push:async function(e){try{await function(e,t,n){var r,i;e=oa(e,oc);let s=oa(e.firestore,oy),a=(r=e.converter,i=void 0,r?i&&(i.merge||i.mergeFields)?r.toFirestore(t,i):r.toFirestore(t):t);return o4(s,[(function(e,t,n,r,i,s={}){let a,o,l=e.gc(s.merge||s.mergeFields?2:0,t,n,i);oP("Data must be an object, but it was:",l,r);let u=oO(r,l);if(s.merge)a=new nC(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=oV(t,r,n);if(!l.contains(i))throw new tY(tW.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);oj(e,i)||e.push(i)}a=new nC(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new oC(new n9(u),a,o)})(oN(s),"setDoc",e._key,a,null!==e.converter,void 0).toMutation(e._key,r5.none())])}(od(this.db,this.key,e.id),{createdAt:new oR("serverTimestamp"),done:e.done,name:e.name})}catch(e){console.error("Error adding document: ",e)}},delete:async function({id:e,fieldName:t}){let n=od(this.db,this.key,e);t?await o5(n,{[t]:new ok("deleteField")}):await deleteDoc(n)},update:async function(e){let t=od(this.db,this.key,e.id);await o5(t,{done:e.done})}},li={filmsIds:[],filmsById:{},addFilm:function({name:e}){let t={name:e,done:!1,id:R()};return this.filmsIds.push(t.id),this.filmsById[t.id]=t,t},setFilms:function(e){this.filmsIds=[],this.filmsById={},e.forEach(e=>{this.filmsIds.push(e.id),this.filmsById[e.id]=e})},getFilms:function(){return{filmsById:this.filmsById,filmsIds:this.filmsIds}},toggleFilm:function(e){this.filmsById[e].done=!this.filmsById[e].done},getFilm:function(e){return this.filmsById[e]}},ls=function(e,t){let n=document.querySelector(e),r=document.getElementById("movie-list");return{node:n,renderFilms:function({filmsIds:e,filmsById:t}){e.forEach(e=>{this.addFilm(t[e])})},clearFilm:function(){this.node.innerHTML=""},addFilm:function(e){let t=document.createElement("li");t.dataset.id=e.id,t.innerHTML=`
            <img class="movie-list_li_img" src="${o7}" alt="">
            ${e.name}
            <img class="movie-list_li_icon" src="${le}" data-field="name" alt="">
            `,t.className="movie-list_li",r.appendChild(t)},addingFilm:function(){let e=inputNode.value;if(""===e.trim())return void alert("Введите название фильма");addFilmToList(e)}}}(".movie-list",0);document.querySelector(".movie-list").addEventListener("click",function(e,t){if(e.target.matches(".movie-list_li_icon")){let t=e.target.closest(".movie-list_li_icon"),n=e.target.closest(".movie-list_li").dataset.id,r=t.dataset.field;lr.delete({id:n,fieldName:r}),console.log(r),li.setFilms([]),ls.clearFilm()}}),lr.pull().then(e=>{li.setFilms(e),ls.renderFilms(li.getFilms())}),lt.addEventListener("click",function(){let e=ln.value,t=li.addFilm({name:e});ls.addFilm(t),lr.push(t)}),console.log(lt);